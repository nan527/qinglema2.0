<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¾…å¯¼å‘˜å·¥ä½œå¹³å° - {{ title }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0EA5E9',
            'primary-light': '#38BDF8',
            'primary-dark': '#0284C7',
            accent: '#6366F1',
            surface: '#F8FAFC',
            success: '#10B981',
            warning: '#F59E0B',
            danger: '#EF4444'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif']
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'slide-up': 'slideUp 0.5s ease-out',
            'fade-in': 'fadeIn 0.6s ease-out',
          }
        }
      }
    };
  </script>

  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    @keyframes glow {
      from { box-shadow: 0 0 20px rgba(14, 165, 233, 0.2); }
      to { box-shadow: 0 0 30px rgba(14, 165, 233, 0.4); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    .glass-nav {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
    }
    .gradient-border {
      position: relative;
      background: linear-gradient(135deg, rgba(14,165,233,0.1), rgba(99,102,241,0.1));
    }
    .gradient-border::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(135deg, #0EA5E9, #6366F1);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }
    .shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }
    .hover-lift {
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .hover-lift:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(14, 165, 233, 0.15);
    }
    .btn-glow {
      position: relative;
      overflow: hidden;
    }
    .btn-glow::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
      transform: rotate(45deg);
      transition: all 0.6s;
      opacity: 0;
    }
    .btn-glow:hover::after {
      animation: shimmer 1.5s;
      opacity: 1;
    }
    .animate-in {
      animation: slideUp 0.5s ease-out forwards;
    }
    .mesh-gradient {
      background: 
        radial-gradient(at 40% 20%, rgba(14, 165, 233, 0.08) 0px, transparent 50%),
        radial-gradient(at 80% 0%, rgba(99, 102, 241, 0.08) 0px, transparent 50%),
        radial-gradient(at 0% 50%, rgba(14, 165, 233, 0.05) 0px, transparent 50%),
        radial-gradient(at 80% 50%, rgba(99, 102, 241, 0.05) 0px, transparent 50%),
        radial-gradient(at 0% 100%, rgba(14, 165, 233, 0.08) 0px, transparent 50%),
        linear-gradient(180deg, #F8FAFC 0%, #EFF6FF 100%);
    }
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #0EA5E9, #6366F1);
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #0284C7, #4F46E5);
    }
    .text-gradient {
      background: linear-gradient(135deg, #0EA5E9, #6366F1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* å‰ç¥¥ç‰©åŠ¨ç”» */
    @keyframes mascotFloat { 0%, 100% { transform: translateY(0) rotate(-2deg); } 50% { transform: translateY(-12px) rotate(2deg); } }
    .mascot-container { position: fixed; bottom: 20px; right: 20px; z-index: 100; cursor: pointer; transition: all 0.3s ease; }
    .mascot-container:hover { transform: scale(1.1); }
    .mascot-container:hover .mascot-bubble { opacity: 1; transform: translateX(0) scale(1); }
    .mascot-img { width: 90px; height: auto; animation: mascotFloat 4s ease-in-out infinite; filter: drop-shadow(0 10px 20px rgba(14, 165, 233, 0.3)); transition: filter 0.3s ease; }
    .mascot-container:hover .mascot-img { filter: drop-shadow(0 15px 30px rgba(14, 165, 233, 0.5)); }
    .mascot-bubble { position: absolute; bottom: 80%; right: 60%; background: white; padding: 8px 14px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-size: 13px; color: #0EA5E9; font-weight: 500; white-space: nowrap; opacity: 0; transform: translateX(10px) scale(0.9); transition: all 0.3s ease; }
    .mascot-bubble::after { content: ''; position: absolute; bottom: -6px; right: 20px; width: 12px; height: 12px; background: white; transform: rotate(45deg); box-shadow: 3px 3px 5px rgba(0,0,0,0.05); }
    @media (max-width: 640px) { .mascot-container { bottom: 10px; right: 10px; } .mascot-img { width: 60px; } .mascot-bubble { font-size: 11px; padding: 6px 10px; } }
  </style>
</head>

<body class="font-sans mesh-gradient min-h-screen text-gray-700">
  <!-- AIåŠ©æ‰‹å‰ç¥¥ç‰© -->
  <div class="mascot-container" id="mascot" onclick="toggleAiChat()">
    <div class="mascot-bubble" id="mascotBubble">æœ‰é—®é¢˜é—®æˆ‘~</div>
    <img src="/static/images/mascot.png" alt="å°é¾™åŠ©æ‰‹" class="mascot-img" draggable="false">
  </div>

  <!-- AIå¯¹è¯æ¡† -->
  <div id="aiChatBox" class="fixed bottom-28 right-6 w-80 glass-card rounded-2xl shadow-2xl z-50 hidden transform transition-all duration-300 scale-95 opacity-0" onclick="event.stopPropagation()">
    <div class="bg-gradient-to-r from-primary to-accent text-white px-4 py-3 rounded-t-2xl flex items-center justify-between">
      <div class="flex items-center">
        <i class="fa-solid fa-robot mr-2"></i>
        <span class="font-medium">å°é¾™åŠ©æ‰‹</span>
        <span class="ml-2 text-xs bg-white/20 px-2 py-0.5 rounded-full">AI</span>
      </div>
      <button onclick="event.stopPropagation(); toggleAiChat()" class="w-7 h-7 rounded-lg hover:bg-white/20 flex items-center justify-center transition-all">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div id="aiChatMessages" class="h-80 overflow-y-auto p-4 space-y-3 custom-scrollbar">
      <div class="flex items-start space-x-2">
        <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
          <i class="fa-solid fa-dragon text-primary text-sm"></i>
        </div>
        <div class="bg-gray-100 rounded-2xl rounded-tl-none px-4 py-2 max-w-[80%]">
          <p class="text-sm text-gray-700">ä½ å¥½è€å¸ˆï¼æˆ‘æ˜¯å°é¾™ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ</p>
        </div>
      </div>
    </div>
    <div class="p-3 border-t border-gray-100" onclick="event.stopPropagation()">
      <div class="flex items-center space-x-2">
        <input type="text" id="aiChatInput" placeholder="è¾“å…¥é—®é¢˜..." class="flex-1 px-4 py-2 rounded-xl border border-gray-200 focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all text-sm" onkeypress="if(event.key==='Enter'){event.stopPropagation();sendAiMessage()}" onclick="event.stopPropagation()">
        <button onclick="event.stopPropagation(); sendAiMessage()" id="aiSendBtn" class="w-10 h-10 rounded-xl bg-primary text-white hover:bg-primary-dark transition-all flex items-center justify-center">
          <i class="fa-solid fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ========== AIåŠ©æ‰‹åŠŸèƒ½ ==========
    let aiChatOpen = false;
    function toggleAiChat() {
      const chatBox = document.getElementById('aiChatBox');
      if (!chatBox) return;
      aiChatOpen = !aiChatOpen;
      if (aiChatOpen) {
        chatBox.classList.remove('hidden');
        setTimeout(() => { chatBox.classList.remove('scale-95', 'opacity-0'); chatBox.classList.add('scale-100', 'opacity-100'); }, 10);
        document.getElementById('aiChatInput')?.focus();
      } else {
        chatBox.classList.remove('scale-100', 'opacity-100'); chatBox.classList.add('scale-95', 'opacity-0');
        setTimeout(() => chatBox.classList.add('hidden'), 300);
      }
    }
    function addAiMessage(content, isUser = false) {
      const container = document.getElementById('aiChatMessages');
      if (!container) return;
      const msgDiv = document.createElement('div');
      msgDiv.className = `flex items-start space-x-2 ${isUser ? 'flex-row-reverse space-x-reverse' : ''}`;
      msgDiv.innerHTML = isUser ? `
        <div class="w-8 h-8 rounded-lg bg-primary flex items-center justify-center flex-shrink-0"><i class="fa-solid fa-user text-white text-sm"></i></div>
        <div class="bg-primary text-white rounded-2xl rounded-tr-none px-4 py-2 max-w-[80%]"><p class="text-sm">${content}</p></div>` : `
        <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0"><i class="fa-solid fa-dragon text-primary text-sm"></i></div>
        <div class="bg-gray-100 rounded-2xl rounded-tl-none px-4 py-2 max-w-[80%]"><p class="text-sm text-gray-700">${content}</p></div>`;
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    async function sendAiMessage() {
      const input = document.getElementById('aiChatInput');
      const sendBtn = document.getElementById('aiSendBtn');
      const message = input?.value?.trim();
      if (!message) return;
      addAiMessage(message, true);
      input.value = '';
      sendBtn.disabled = true;
      sendBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
      addAiMessage('<i class="fa-solid fa-ellipsis fa-beat"></i> æ€è€ƒä¸­...');
      try {
        const response = await fetch('/api/ai/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message }) });
        const data = await response.json();
        const container = document.getElementById('aiChatMessages');
        container.removeChild(container.lastChild);
        addAiMessage(data.success ? data.reply : 'ğŸ˜… ' + (data.message || 'æŠ±æ­‰ï¼Œå‡ºäº†ç‚¹é—®é¢˜'));
      } catch (error) {
        const container = document.getElementById('aiChatMessages');
        container.removeChild(container.lastChild);
        addAiMessage('ğŸ˜… ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•');
      }
      sendBtn.disabled = false;
      sendBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i>';
    }
  </script>

  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="glass-nav sticky top-0 z-50 border-b border-white/50 shadow-lg shadow-primary/5">
    <div class="container mx-auto px-6 py-3">
      <div class="flex justify-between items-center">
        <!-- LogoåŒºåŸŸ -->
        <div class="flex items-center space-x-3">
          <img src="/static/images/logo.png" alt="è¯·äº†å—" class="w-11 h-11 object-contain">
          <div>
            <h1 class="text-xl font-bold bg-gradient-to-r from-purple-600 to-purple-400 bg-clip-text text-transparent">è¯·äº†å—</h1>
            <p class="text-xs text-gray-400 font-medium tracking-wide">è¾…å¯¼å‘˜å·¥ä½œå°</p>
          </div>
        </div>
        
        <!-- å¯¼èˆªèœå• -->
        <nav class="hidden md:flex items-center bg-white/50 rounded-2xl p-1.5 shadow-inner">
          <a href="/counselor/all" class="nav-item px-5 py-2.5 rounded-xl text-gray-600 hover:text-primary hover:bg-white hover:shadow-md transition-all duration-300 text-sm font-medium flex items-center space-x-2">
            <i class="fa-solid fa-clipboard-check"></i>
            <span>å®¡æ‰¹ä¸­å¿ƒ</span>
          </a>
          <a href="/counselor/statistics" class="nav-item px-5 py-2.5 rounded-xl text-gray-600 hover:text-primary hover:bg-white hover:shadow-md transition-all duration-300 text-sm font-medium flex items-center space-x-2">
            <i class="fa-solid fa-chart-line"></i>
            <span>æ•°æ®ç»Ÿè®¡</span>
          </a>
          <a href="/counselor/chat" class="nav-item px-5 py-2.5 rounded-xl text-gray-600 hover:text-primary hover:bg-white hover:shadow-md transition-all duration-300 text-sm font-medium flex items-center space-x-2">
            <i class="fa-solid fa-message"></i>
            <span>æ¶ˆæ¯</span>
          </a>
          <a href="/counselor/profile" class="nav-item px-5 py-2.5 rounded-xl text-gray-600 hover:text-primary hover:bg-white hover:shadow-md transition-all duration-300 text-sm font-medium flex items-center space-x-2">
            <i class="fa-solid fa-sliders"></i>
            <span>è®¾ç½®</span>
          </a>
        </nav>
        
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div class="flex items-center space-x-3">
          <a href="/counselor/profile" class="flex items-center space-x-3 px-4 py-2 rounded-2xl glass-card hover-lift group cursor-pointer">
            <div class="relative">
              <img src="/head_image/{{ user_info.avatar or 'boy.png' }}" 
                   alt="å¤´åƒ" 
                   class="w-11 h-11 rounded-xl object-cover ring-2 ring-white shadow-lg group-hover:ring-primary/50 transition-all duration-300"
                   onerror="this.src='/head_image/boy.png'">
              <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
            </div>
            <div class="hidden sm:block">
              <div class="flex items-center space-x-2">
                <p class="text-sm font-bold text-gray-800" id="counselorName">{{ user_info.user_name }}</p>
                <div id="headerLevelBadge" class="hidden items-center px-2 py-0.5 rounded-full text-xs font-bold">
                  <i id="headerLevelIcon" class="mr-1 text-xs"></i>
                  <span id="headerLevelText"></span>
                </div>
              </div>
              <p class="text-xs text-primary font-medium">è¾…å¯¼å‘˜</p>
            </div>
            <i class="fa-solid fa-chevron-down text-xs text-gray-400 group-hover:text-primary transition-colors"></i>
          </a>
          <button id="logoutBtn" class="w-10 h-10 rounded-xl glass-card flex items-center justify-center text-gray-400 hover:text-red-500 hover:bg-red-50 transition-all duration-300 hover:scale-105" title="é€€å‡ºç™»å½•">
            <i class="fa-solid fa-power-off"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="container mx-auto px-6 py-10 max-w-6xl">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="mb-10 animate-in">
      <div class="flex items-center space-x-3 mb-2">
        <div class="w-1.5 h-8 bg-gradient-to-b from-primary to-accent rounded-full"></div>
        <h2 class="text-3xl font-bold bg-gradient-to-r from-gray-800 via-gray-700 to-gray-600 bg-clip-text text-transparent">è¯·å‡å®¡æ‰¹ç®¡ç†</h2>
      </div>
      <p class="text-gray-500 ml-5">å®æ—¶æŸ¥çœ‹å’Œå¤„ç†å­¦ç”Ÿçš„è¯·å‡ç”³è¯·</p>
    </div>