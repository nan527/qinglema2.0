# 工作记录功能说明

## 功能概述

工作记录功能用于记录和查看管理员对系统用户的增删改查操作，提供完整的操作审计功能。

## 安装步骤

### 1. 创建数据库表

首先需要在数据库中执行以下SQL创建操作日志表：

```sql
-- 执行 create_admin_logs.sql 文件
mysql -u root -p your_database < create_admin_logs.sql
```

或者手动执行：

```sql
CREATE TABLE IF NOT EXISTS admin_operation_logs (
    log_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '日志ID',
    admin_account VARCHAR(50) NOT NULL COMMENT '操作管理员账号',
    admin_name VARCHAR(100) COMMENT '操作管理员姓名',
    operation_type VARCHAR(20) NOT NULL COMMENT '操作类型：ADD/UPDATE/DELETE/VIEW',
    target_user_account VARCHAR(50) COMMENT '目标用户账号',
    target_user_name VARCHAR(100) COMMENT '目标用户姓名',
    target_user_role VARCHAR(20) COMMENT '目标用户角色：student/counselor/teacher/admin',
    operation_details TEXT COMMENT '操作详情JSON',
    operation_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    ip_address VARCHAR(50) COMMENT 'IP地址',
    status VARCHAR(20) DEFAULT 'SUCCESS' COMMENT '操作状态：SUCCESS/FAILED',
    error_message TEXT COMMENT '错误信息（如果失败）',
    INDEX idx_admin_account (admin_account),
    INDEX idx_operation_time (operation_time),
    INDEX idx_operation_type (operation_type),
    INDEX idx_target_user (target_user_account)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='管理员操作日志表';
```

### 2. 功能入口

- 登录管理员账号
- 点击顶部导航栏的 **"工作记录"** 标签
- 进入工作记录页面查看操作日志

## 功能特性

### 1. 日志查看
- **操作时间**: 精确到秒的操作时间记录
- **操作管理员**: 显示执行操作的管理员账号和姓名
- **操作类型**: 新增/修改/删除/查看用户
- **目标用户**: 被操作的用户账号和姓名
- **用户角色**: 学生/辅导员/教师/管理员
- **操作详情**: 操作的详细信息
- **状态**: 成功/失败

### 2. 筛选功能
- **操作类型筛选**: 筛选特定类型的操作（新增/修改/删除/查看）
- **用户角色筛选**: 筛选针对特定角色的操作
- **时间范围筛选**: 
  - 今天
  - 最近一周
  - 最近一月
  - 全部时间

### 3. 界面特色
- 美观的现代化UI设计
- 颜色编码的操作类型和状态
- 实时刷新功能
- 响应式布局，支持移动端

## API接口

### 获取操作日志
```
GET /api/admin/operation-logs
```

**查询参数：**
- `operation_type`: 操作类型（ADD/UPDATE/DELETE/VIEW）
- `user_role`: 用户角色（student/counselor/teacher/admin）
- `time_range`: 时间范围（today/week/month/all）

**响应示例：**
```json
{
  "success": true,
  "data": [
    {
      "log_id": 1,
      "admin_account": "1001",
      "admin_name": "张三",
      "operation_type": "ADD",
      "target_user_account": "202301010101",
      "target_user_name": "李四",
      "target_user_role": "student",
      "operation_details": "新增学生用户",
      "operation_time": "2023-12-07 15:30:25",
      "ip_address": "192.168.1.100",
      "status": "SUCCESS",
      "error_message": null
    }
  ]
}
```

## 开发集成

如果需要在其他操作中记录日志，可以使用辅助函数：

```python
from app import log_admin_operation

# 在用户操作成功后调用
log_admin_operation(
    operation_type='ADD',  # 操作类型
    target_account='202301010101',  # 目标用户账号
    target_name='李四',  # 目标用户姓名
    target_role='student',  # 目标用户角色
    details='新增学生用户，年级：2023级，专业：计算机科学与技术',  # 操作详情
    status='SUCCESS'  # 操作状态
)

# 操作失败时调用
log_admin_operation(
    operation_type='DELETE',
    target_account='202301010101',
    target_name='李四',
    target_role='student',
    details='尝试删除学生用户',
    status='FAILED',
    error_msg='管理员用户不允许删除'  # 错误信息
)
```

## 注意事项

1. **权限控制**: 只有管理员账号可以访问工作记录页面
2. **数据库依赖**: 必须先创建 `admin_operation_logs` 表
3. **性能优化**: 日志查询限制最多返回1000条记录
4. **日志保留**: 建议定期归档或清理过期日志

## 未来扩展

可以考虑添加以下功能：
- 导出日志为Excel/CSV
- 日志统计图表
- 异常操作告警
- 日志详情查看（弹窗显示完整详情）
- 按管理员统计操作次数
- 敏感操作二次确认

## 技术栈

- **前端**: HTML5, TailwindCSS, JavaScript
- **后端**: Flask (Python)
- **数据库**: MySQL 8.0+
- **图标**: Font Awesome 6

## 更新日志

### v1.0.0 (2023-12-07)
- ✅ 创建操作日志数据库表
- ✅ 添加工作记录页面UI
- ✅ 实现日志查询API
- ✅ 添加筛选功能
- ✅ 完成日志记录辅助函数
