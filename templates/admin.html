<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†å‘˜æ“ä½œä¸­å¿ƒ - å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            'primary-light': '#4080FF',
            'primary-dark': '#0E42D2',
            accent: '#00D4FF',
            surface: '#F0F5FF',
            success: '#10B981',
            warning: '#F59E0B',
            danger: '#EF4444'
          },
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'slide-up': 'slideUp 0.5s ease-out',
            'fade-in': 'fadeIn 0.6s ease-out',
            'scaleIn': 'scaleIn 0.3s ease-out'
          }
        }
      }
    };
  </script>

  <style>
    /* åŠ¨æ€ç²’å­èƒŒæ™¯ */
    body {
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(22, 93, 255, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(22, 93, 255, 0.1) 0%, transparent 40%),
        radial-gradient(circle at 90% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 40%);
      animation: gradientShift 20s ease infinite;
      pointer-events: none;
      z-index: 0;
    }
    
    @keyframes gradientShift {
      0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
      50% { opacity: 0.8; transform: scale(1.1) rotate(5deg); }
    }
    
    /* å‘å…‰æ–‡å­—æ•ˆæœ */
    .glow-text {
      text-shadow: 
        0 0 10px rgba(22, 93, 255, 0.5),
        0 0 20px rgba(22, 93, 255, 0.3),
        0 0 30px rgba(22, 93, 255, 0.2);
      animation: textGlow 3s ease-in-out infinite;
    }
    
    @keyframes textGlow {
      0%, 100% { 
        text-shadow: 
          0 0 10px rgba(22, 93, 255, 0.5),
          0 0 20px rgba(22, 93, 255, 0.3),
          0 0 30px rgba(22, 93, 255, 0.2);
      }
      50% { 
        text-shadow: 
          0 0 20px rgba(22, 93, 255, 0.8),
          0 0 30px rgba(22, 93, 255, 0.5),
          0 0 40px rgba(22, 93, 255, 0.3);
      }
    }
    
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes glow { from { box-shadow: 0 0 20px rgba(22, 93, 255, 0.2); } to { box-shadow: 0 0 30px rgba(22, 93, 255, 0.4); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    @keyframes pulse-subtle { 
      0%, 100% { transform: scale(1); opacity: 1; } 
      50% { transform: scale(1.05); opacity: 0.9; } 
    }
    @keyframes bounce-gentle { 
      0%, 100% { transform: translateY(0); } 
      50% { transform: translateY(-5px); } 
    }
    
    /* æµå…‰è¾¹æ¡†æ•ˆæœ */
    @keyframes borderFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* 3Dé€è§†æ•ˆæœ */
    .card-3d {
      transform-style: preserve-3d;
      perspective: 1000px;
    }
    
    .card-3d:hover {
      transform: rotateX(2deg) rotateY(-2deg) scale(1.02);
    }
    
    .glass-card { 
      background: rgba(255, 255, 255, 0.95); 
      backdrop-filter: blur(30px) saturate(180%); 
      -webkit-backdrop-filter: blur(30px) saturate(180%); 
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 8px 32px rgba(22, 93, 255, 0.12), 
                  0 4px 16px rgba(0, 0, 0, 0.08),
                  inset 0 1px 0 rgba(255, 255, 255, 0.7);
    }
    .glass-nav { 
      background: rgba(255, 255, 255, 0.9); 
      backdrop-filter: blur(25px) saturate(180%); 
      -webkit-backdrop-filter: blur(25px) saturate(180%);
      box-shadow: 0 4px 24px rgba(22, 93, 255, 0.08);
    }
    .gradient-border { 
      position: relative; 
      background: linear-gradient(135deg, rgba(22,93,255,0.08), rgba(0,212,255,0.08)); 
    }
    .gradient-border::before { 
      content: ''; 
      position: absolute; 
      inset: 0; 
      border-radius: inherit; 
      padding: 1px; 
      background: linear-gradient(135deg, #165DFF, #00D4FF); 
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); 
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); 
      -webkit-mask-composite: xor; 
      mask-composite: exclude; 
    }
    .shimmer { 
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); 
      background-size: 200% 100%; 
      animation: shimmer 2s infinite; 
    }
    .hover-lift { 
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); 
      position: relative;
    }
    .hover-lift:hover { 
      transform: translateY(-8px) scale(1.02); 
      box-shadow: 0 24px 48px rgba(22, 93, 255, 0.2),
                  0 12px 24px rgba(0, 0, 0, 0.12); 
    }
    .hover-lift::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      opacity: 0;
      background: linear-gradient(135deg, rgba(22, 93, 255, 0.1), rgba(0, 212, 255, 0.1));
      transition: opacity 0.5s;
    }
    .hover-lift:hover::after {
      opacity: 1;
    }
    .btn-glow { position: relative; overflow: hidden; }
    .btn-glow::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent); transform: rotate(45deg); transition: all 0.6s; opacity: 0; }
    .btn-glow:hover::after { animation: shimmer 1.5s; opacity: 1; }
    .animate-in { animation: slideUp 0.5s ease-out forwards; }
    .animate-scaleIn { animation: scaleIn 0.3s ease-out; }
    .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
    .mesh-gradient { background: radial-gradient(at 40% 20%, rgba(22, 93, 255, 0.08) 0px, transparent 50%), radial-gradient(at 80% 0%, rgba(0, 212, 255, 0.08) 0px, transparent 50%), radial-gradient(at 0% 50%, rgba(22, 93, 255, 0.05) 0px, transparent 50%), radial-gradient(at 80% 50%, rgba(0, 212, 255, 0.05) 0px, transparent 50%), radial-gradient(at 0% 100%, rgba(22, 93, 255, 0.08) 0px, transparent 50%), linear-gradient(180deg, #F0F5FF 0%, #E6F0FF 100%); }
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #165DFF, #00D4FF); border-radius: 10px; }
    .text-gradient { background: linear-gradient(135deg, #165DFF, #0E42D2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    
    /* Form styles */
    .form-group { margin-bottom: 1.25rem; }
    .form-group label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem; }
    .form-group small { font-size: 0.75rem; color: #6B7280; margin-top: 0.25rem; display: block; }
    .form-control { width: 100%; padding: 0.75rem 1rem; border-radius: 0.75rem; border: 1px solid #E5E7EB; background-color: white; transition: all 0.3s; }
    .form-control:focus { outline: none; border-color: #165DFF; box-shadow: 0 0 0 3px rgba(22, 93, 255, 0.1); }
    
    /* Button styles */
    .btn { 
      padding: 0.75rem 1.25rem; 
      border: none; 
      border-radius: 0.75rem; 
      cursor: pointer; 
      font-weight: 500; 
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
      position: relative;
      overflow: hidden;
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    .btn-primary { 
      background: linear-gradient(135deg, #165DFF, #00D4FF); 
      color: white; 
      box-shadow: 0 4px 12px rgba(22, 93, 255, 0.3),
                  0 2px 4px rgba(22, 93, 255, 0.2); 
    }
    .btn-primary:hover { 
      box-shadow: 0 8px 24px rgba(22, 93, 255, 0.4),
                  0 4px 8px rgba(22, 93, 255, 0.3); 
      transform: translateY(-2px) scale(1.02); 
    }
    .btn-danger { 
      background: linear-gradient(135deg, #EF4444, #DC2626); 
      color: white; 
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3),
                  0 2px 4px rgba(239, 68, 68, 0.2); 
    }
    .btn-danger:hover { 
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4),
                  0 4px 8px rgba(239, 68, 68, 0.3); 
      transform: translateY(-2px) scale(1.02); 
    }
    .btn-group { margin-top: 1.5rem; display: flex; gap: 0.75rem; }
    
    /* Table styles */
    .data-table { width: 100%; border-collapse: separate; border-spacing: 0; }
    .data-table thead th { background: linear-gradient(135deg, #F0F5FF, #E6F0FF); padding: 1rem; text-align: left; font-weight: 600; color: #165DFF; border-bottom: 2px solid #165DFF; }
    .data-table thead th:first-child { border-top-left-radius: 0.75rem; }
    .data-table thead th:last-child { border-top-right-radius: 0.75rem; }
    .data-table tbody td { padding: 0.875rem 1rem; border-bottom: 1px solid #E5E7EB; color: #374151; }
    .data-table tbody tr:hover { background-color: #F9FAFB; }
    .data-table tbody tr:last-child td:first-child { border-bottom-left-radius: 0.75rem; }
    .data-table tbody tr:last-child td:last-child { border-bottom-right-radius: 0.75rem; }
    
    /* Message styles */
    .message { padding: 0.75rem 1rem; border-radius: 0.75rem; margin-bottom: 1rem; display: none; }
    .message-success { display: block; background-color: #D1FAE5; color: #065F46; border: 1px solid #A7F3D0; }
    .message-error { display: block; background-color: #FEE2E2; color: #991B1B; border: 1px solid #FECACA; }
    .text-danger { color: #EF4444; font-size: 0.875rem; margin-top: 0.5rem; }
    
    /* Page content styles */
    .page-content.hidden { display: none; }
  </style>
</head>
<body class="font-sans mesh-gradient min-h-screen text-gray-700">
  <!-- Toastæç¤º -->
  <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 transition-opacity opacity-0 pointer-events-none"></div>

  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="glass-nav sticky top-0 z-50 border-b border-white/50 shadow-lg shadow-primary/5">
    <div class="container mx-auto px-6 py-3">
      <div class="flex justify-between items-center">
        <!-- LogoåŒºåŸŸ -->
        <div class="flex items-center space-x-4">
          <div class="relative group">
            <div class="absolute -inset-1 bg-gradient-to-r from-primary via-accent to-primary-light rounded-2xl blur opacity-40 group-hover:opacity-70 transition duration-500"></div>
            <div class="relative w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center shadow-xl">
              <i class="fa-solid fa-user-shield text-white text-xl"></i>
            </div>
          </div>
          <div>
            <h1 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">ç®¡ç†å‘˜æ“ä½œä¸­å¿ƒ</h1>
            <p class="text-xs text-gray-400 font-medium tracking-wide">ADMIN PORTAL</p>
          </div>
        </div>
        
        <!-- å¯¼èˆªèœå• -->
        <nav class="hidden md:flex items-center bg-white/50 rounded-2xl p-1.5 shadow-inner">
          <button onclick="switchTab('management')" id="tab-management" class="nav-tab px-5 py-2.5 rounded-xl text-primary bg-white shadow-md text-sm font-medium flex items-center space-x-2">
            <i class="fa-solid fa-users-gear"></i><span>ç”¨æˆ·ç®¡ç†</span>
          </button>
          <button onclick="switchTab('logs')" id="tab-logs" class="nav-tab px-5 py-2.5 rounded-xl text-gray-600 hover:text-primary hover:bg-white hover:shadow-md transition-all duration-300 text-sm font-medium flex items-center space-x-2">
            <i class="fa-solid fa-clipboard-list"></i><span>å·¥ä½œè®°å½•</span>
          </button>

          <button onclick="switchTab('profile')" id="tab-profile" class="nav-tab px-5 py-2.5 rounded-xl text-gray-600 hover:text-primary hover:bg-white hover:shadow-md transition-all duration-300 text-sm font-medium flex items-center space-x-2">

            <i class="fa-solid fa-user-gear"></i><span>ä¸ªäººä¿¡æ¯</span>

          </button>

        </nav>

        <!-- ç”¨æˆ·ä¿¡æ¯ -->

        <div class="flex items-center space-x-3">

          <div onclick="switchTab('profile')" class="flex items-center space-x-3 px-4 py-2 rounded-2xl glass-card hover-lift group cursor-pointer transition-all hover:scale-105" title="ç‚¹å‡»æŸ¥çœ‹ä¸ªäººä¿¡æ¯">

            <div class="relative">

              <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white font-bold text-lg shadow-lg group-hover:shadow-xl transition-all">

                A

              </div>

              <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse"></div>

            </div>

            <div class="hidden sm:block">

              <p id="userName" class="text-sm font-bold text-gray-800 group-hover:text-primary transition-colors">ç®¡ç†å‘˜</p>

              <p class="text-xs text-primary font-medium">ç®¡ç†å‘˜</p>

            </div>

          </div>

          <button id="logoutBtn" class="w-10 h-10 rounded-xl glass-card flex items-center justify-center text-gray-400 hover:text-red-500 hover:bg-red-50 transition-all duration-300 hover:scale-105" title="é€€å‡ºç™»å½•">

            <i class="fa-solid fa-power-off"></i>

          </button>

        </div>

      </div>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="container mx-auto px-6 py-10 max-w-7xl">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="mb-10 animate-in">
      <div class="flex items-center space-x-3 mb-2">
        <div class="w-1.5 h-8 bg-gradient-to-b from-primary to-accent rounded-full"></div>
        <h2 id="pageTitle" class="text-3xl font-bold bg-gradient-to-r from-gray-800 via-gray-700 to-gray-600 bg-clip-text text-transparent">ç³»ç»Ÿç®¡ç†</h2>
      </div>
      <p id="pageSubtitle" class="text-gray-500 ml-5">ç®¡ç†ç³»ç»Ÿç”¨æˆ·å’ŒæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</p>
    </div>

    <!-- ç”¨æˆ·ç®¡ç†é¡µé¢ -->
    <div id="page-management" class="page-content">
      <!-- åŠŸèƒ½æ¿å— - åˆ—å¸ƒå±€ -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- åˆ—1: æŸ¥çœ‹ä¿¡æ¯ -->
        <div class="glass-card rounded-3xl p-6 animate-in flex flex-col" style="animation-delay: 0.1s">
          <div class="flex items-center mb-6 pb-4 border-b border-gray-200">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mr-3">
              <i class="fa-solid fa-eye text-white text-lg"></i>
          </div>
          <div>
            <h3 class="text-lg font-bold text-gray-800">æŸ¥çœ‹ä¿¡æ¯</h3>
            <p class="text-xs text-gray-500">ç”¨æˆ·è¯¦ç»†ä¿¡æ¯</p>
          </div>
        </div>
        <div class="space-y-3 flex-1">
          <!-- æŸ¥çœ‹å­¦ç”Ÿä¿¡æ¯ -->
          <a href="/admin/students" class="block bg-white/50 rounded-xl p-4 hover-lift cursor-pointer group border border-blue-100">
            <div class="flex items-center">
              <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500/20 to-blue-600/10 flex items-center justify-center mr-3 group-hover:scale-110 transition-transform">
                <i class="fa-solid fa-user-graduate text-blue-600 text-lg"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-bold text-gray-800 text-sm">å­¦ç”Ÿä¿¡æ¯</h4>
                <p class="text-xs text-gray-500">æŸ¥çœ‹å­¦ç”Ÿè´¦æˆ·</p>
              </div>
              <i class="fa-solid fa-arrow-right text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all"></i>
            </div>
          </a>

          <!-- æŸ¥çœ‹æ•™å¸ˆä¿¡æ¯ -->
          <a href="/admin/teachers" class="block bg-white/50 rounded-xl p-4 hover-lift cursor-pointer group border border-amber-100">
            <div class="flex items-center">
              <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500/20 to-amber-600/10 flex items-center justify-center mr-3 group-hover:scale-110 transition-transform">
                <i class="fa-solid fa-chalkboard-user text-amber-600 text-lg"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-bold text-gray-800 text-sm">æ•™å¸ˆä¿¡æ¯</h4>
                <p class="text-xs text-gray-500">æŸ¥çœ‹æ•™å¸ˆè´¦æˆ·</p>
              </div>
              <i class="fa-solid fa-arrow-right text-gray-400 group-hover:text-amber-600 group-hover:translate-x-1 transition-all"></i>
            </div>
          </a>

          <!-- æŸ¥çœ‹è¾…å¯¼å‘˜ä¿¡æ¯ -->
          <a href="/admin/counselors" class="block bg-white/50 rounded-xl p-4 hover-lift cursor-pointer group border border-purple-100">
            <div class="flex items-center">
              <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500/20 to-purple-600/10 flex items-center justify-center mr-3 group-hover:scale-110 transition-transform">
                <i class="fa-solid fa-user-tie text-purple-600 text-lg"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-bold text-gray-800 text-sm">è¾…å¯¼å‘˜ä¿¡æ¯</h4>
                <p class="text-xs text-gray-500">æŸ¥çœ‹è¾…å¯¼å‘˜è´¦æˆ·</p>
              </div>
              <i class="fa-solid fa-arrow-right text-gray-400 group-hover:text-purple-600 group-hover:translate-x-1 transition-all"></i>
            </div>
          </a>

          <!-- æŸ¥çœ‹ç®¡ç†å‘˜ä¿¡æ¯ -->
          <a href="/admin/admins" class="block bg-white/50 rounded-xl p-4 hover-lift cursor-pointer group border border-red-100">
            <div class="flex items-center">
              <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-red-500/20 to-red-600/10 flex items-center justify-center mr-3 group-hover:scale-110 transition-transform">
                <i class="fa-solid fa-user-shield text-red-600 text-lg"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-bold text-gray-800 text-sm">ç®¡ç†å‘˜ä¿¡æ¯</h4>
                <p class="text-xs text-gray-500">æŸ¥çœ‹ç®¡ç†å‘˜è´¦æˆ·</p>
              </div>
              <i class="fa-solid fa-arrow-right text-gray-400 group-hover:text-red-600 group-hover:translate-x-1 transition-all"></i>
            </div>
          </a>
        </div>
      </div>

      <!-- åˆ—2: æ–°å¢ç”¨æˆ· -->
      <div class="glass-card rounded-3xl p-6 animate-in flex flex-col" style="animation-delay: 0.2s">
        <div class="flex items-center mb-6 pb-4 border-b border-gray-200">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center mr-3">
            <i class="fa-solid fa-user-plus text-white text-lg"></i>
          </div>
          <div>
            <h3 class="text-lg font-bold text-gray-800">æ–°å¢ç”¨æˆ·</h3>
            <p class="text-xs text-gray-500">æ·»åŠ æ–°è´¦æˆ·</p>
          </div>
        </div>
        <div class="flex-1">
          <div class="bg-white/50 rounded-xl p-5 hover-lift cursor-pointer group border border-green-100 h-full flex items-center" data-action="add-user">
            <div class="w-full">
              <div class="flex items-center justify-center mb-4">
                <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-green-500/20 to-green-600/10 flex items-center justify-center group-hover:scale-110 transition-transform">
                  <i class="fa-solid fa-user-plus text-green-600 text-2xl"></i>
                </div>
              </div>
              <div class="text-center">
                <h4 class="text-base font-bold text-gray-800 mb-2">æ·»åŠ æ–°ç”¨æˆ·</h4>
                <p class="text-sm text-gray-500">åˆ›å»ºå­¦ç”Ÿã€æ•™å¸ˆã€è¾…å¯¼å‘˜æˆ–ç®¡ç†å‘˜è´¦æˆ·</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- åˆ—3: ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ -->
      <div class="glass-card rounded-3xl p-6 animate-in flex flex-col" style="animation-delay: 0.3s">
        <div class="flex items-center mb-6 pb-4 border-b border-gray-200">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-cyan-600 flex items-center justify-center mr-3">
            <i class="fa-solid fa-user-pen text-white text-lg"></i>
          </div>
          <div>
            <h3 class="text-lg font-bold text-gray-800">ä¿®æ”¹ä¿¡æ¯</h3>
            <p class="text-xs text-gray-500">ç¼–è¾‘ç”¨æˆ·èµ„æ–™</p>
          </div>
        </div>
        <div class="flex-1">
          <div class="bg-white/50 rounded-xl p-5 hover-lift cursor-pointer group border border-cyan-100 h-full flex items-center" data-action="update-user">
            <div class="w-full">
              <div class="flex items-center justify-center mb-4">
                <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-cyan-500/20 to-cyan-600/10 flex items-center justify-center group-hover:scale-110 transition-transform">
                  <i class="fa-solid fa-user-pen text-cyan-600 text-2xl"></i>
                </div>
              </div>
              <div class="text-center">
                <h4 class="text-base font-bold text-gray-800 mb-2">ç¼–è¾‘ç”¨æˆ·èµ„æ–™</h4>
                <p class="text-sm text-gray-500">ä¿®æ”¹ç”¨æˆ·å§“åã€å¯†ç æˆ–è§’è‰²ç±»å‹</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- åˆ—4: åˆ é™¤ç”¨æˆ· -->
      <div class="glass-card rounded-3xl p-6 animate-in flex flex-col" style="animation-delay: 0.4s">
        <div class="flex items-center mb-6 pb-4 border-b border-gray-200">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-rose-500 to-rose-600 flex items-center justify-center mr-3">
            <i class="fa-solid fa-user-xmark text-white text-lg"></i>
          </div>
          <div>
            <h3 class="text-lg font-bold text-gray-800">åˆ é™¤ç”¨æˆ·</h3>
            <p class="text-xs text-gray-500">ç§»é™¤è´¦æˆ·</p>
          </div>
        </div>
        <div class="flex-1">
          <div class="bg-white/50 rounded-xl p-5 hover-lift cursor-pointer group border border-rose-100 h-full flex items-center" data-action="delete-user">
            <div class="w-full">
              <div class="flex items-center justify-center mb-4">
                <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-rose-500/20 to-rose-600/10 flex items-center justify-center group-hover:scale-110 transition-transform">
                  <i class="fa-solid fa-user-xmark text-rose-600 text-2xl"></i>
                </div>
              </div>
              <div class="text-center">
                <h4 class="text-base font-bold text-gray-800 mb-2">ç§»é™¤ç”¨æˆ·è´¦æˆ·</h4>
                <p class="text-sm text-gray-500">æ°¸ä¹…åˆ é™¤ç”¨æˆ·ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- å·¥ä½œè®°å½•é¡µé¢ -->
    <div id="page-logs" class="page-content hidden">
      <!-- ç»Ÿè®¡å¡ç‰‡åŒº -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <!-- æ€»æ“ä½œæ•° -->
        <div class="glass-card rounded-2xl p-6 animate-in" style="animation-delay: 0.1s">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500 mb-1">æ€»æ“ä½œæ•°</p>
              <p id="statTotal" class="text-3xl font-bold text-gray-800">0</p>
            </div>
            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-chart-line text-white text-2xl"></i>
            </div>
          </div>
        </div>
        
        <!-- æ–°å¢æ“ä½œ -->
        <div class="glass-card rounded-2xl p-6 animate-in" style="animation-delay: 0.2s">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500 mb-1">æ–°å¢æ“ä½œ</p>
              <p id="statAdd" class="text-3xl font-bold text-green-600">0</p>
            </div>
            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-user-plus text-white text-2xl"></i>
            </div>
          </div>
        </div>
        
        <!-- ä¿®æ”¹æ“ä½œ -->
        <div class="glass-card rounded-2xl p-6 animate-in" style="animation-delay: 0.3s">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500 mb-1">ä¿®æ”¹æ“ä½œ</p>
              <p id="statUpdate" class="text-3xl font-bold text-cyan-600">0</p>
            </div>
            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-500 to-cyan-600 flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-user-pen text-white text-2xl"></i>
            </div>
          </div>
        </div>
        
        <!-- åˆ é™¤æ“ä½œ -->
        <div class="glass-card rounded-2xl p-6 animate-in" style="animation-delay: 0.4s">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-500 mb-1">åˆ é™¤æ“ä½œ</p>
              <p id="statDelete" class="text-3xl font-bold text-rose-600">0</p>
            </div>
            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-rose-500 to-rose-600 flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-user-xmark text-white text-2xl"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- ç­›é€‰åŒº -->
      <div class="glass-card rounded-3xl p-6 mb-6 animate-in" style="animation-delay: 0.5s">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center mr-3">
            <i class="fa-solid fa-filter text-white"></i>
          </div>
          <h3 class="text-lg font-bold text-gray-800">ç­›é€‰æ¡ä»¶</h3>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-2">
              <i class="fa-solid fa-list mr-1 text-primary"></i>æ“ä½œç±»å‹
            </label>
            <select id="filterOperationType" class="w-full px-4 py-2.5 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all text-sm hover:border-primary/50">
              <option value="">å…¨éƒ¨æ“ä½œ</option>
              <option value="ADD">âœ¨ æ–°å¢ç”¨æˆ·</option>
              <option value="UPDATE">ğŸ“ ä¿®æ”¹ç”¨æˆ·</option>
              <option value="DELETE">ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·</option>
              <option value="VIEW">ğŸ‘ï¸ æŸ¥çœ‹ä¿¡æ¯</option>
            </select>
          </div>
          
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-2">
              <i class="fa-solid fa-user-tag mr-1 text-primary"></i>ç›®æ ‡è§’è‰²
            </label>
            <select id="filterUserRole" class="w-full px-4 py-2.5 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all text-sm hover:border-primary/50">
              <option value="">å…¨éƒ¨è§’è‰²</option>
              <option value="student">ğŸ“ å­¦ç”Ÿ</option>
              <option value="counselor">ğŸ‘¨â€ğŸ« è¾…å¯¼å‘˜</option>
              <option value="teacher">ğŸ‘©â€ğŸ« æ•™å¸ˆ</option>
              <option value="admin">ğŸ‘‘ ç®¡ç†å‘˜</option>
            </select>
          </div>
          
          <div>
            <label class="block text-xs font-semibold text-gray-600 mb-2">
              <i class="fa-solid fa-calendar mr-1 text-primary"></i>æ—¶é—´èŒƒå›´
            </label>
            <select id="filterTimeRange" class="w-full px-4 py-2.5 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all text-sm hover:border-primary/50">
              <option value="all">ğŸ“… å…¨éƒ¨æ—¶é—´</option>
              <option value="today">â˜€ï¸ ä»Šå¤©</option>
              <option value="week">ğŸ“† æœ€è¿‘ä¸€å‘¨</option>
              <option value="month">ğŸ“Š æœ€è¿‘ä¸€æœˆ</option>
            </select>
          </div>
          
          <div class="flex items-end">
            <button id="refreshLogsBtn" class="w-full px-4 py-2.5 bg-gradient-to-r from-primary to-accent text-white rounded-xl font-semibold hover:shadow-xl transition-all btn-glow flex items-center justify-center space-x-2 hover:scale-105">
              <i class="fa-solid fa-arrows-rotate"></i>
              <span>åˆ·æ–°æ•°æ®</span>
            </button>
          </div>
        </div>
      </div>

      <!-- æ—¥å¿—åˆ—è¡¨ -->
      <div class="glass-card rounded-3xl p-6 animate-in" style="animation-delay: 0.6s">
        <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-200">
          <div class="flex items-center">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center mr-3 shadow-lg">
              <i class="fa-solid fa-history text-white text-xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-800">æ“ä½œæ—¥å¿—</h3>
              <p class="text-xs text-gray-500 mt-0.5">Operation Logs</p>
            </div>
          </div>
          <div id="logsCount" class="px-5 py-2.5 bg-gradient-to-r from-primary/10 to-accent/10 rounded-xl border-2 border-primary/20">
            <span class="text-sm font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">å…± 0 æ¡è®°å½•</span>
          </div>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="logsLoading" class="text-center py-16">
          <div class="inline-block p-5 rounded-2xl bg-gradient-to-br from-primary/5 to-accent/5 mb-4">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-primary"></i>
          </div>
          <p class="text-lg font-semibold text-gray-700 mb-1">æ­£åœ¨åŠ è½½æ—¥å¿—æ•°æ®</p>
          <p class="text-sm text-gray-400">è¯·ç¨å€™...</p>
        </div>

        <!-- æ—¥å¿—è¡¨æ ¼ -->
        <div id="logsTableContainer" class="hidden overflow-x-auto custom-scrollbar">
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gradient-to-r from-primary/10 via-primary/5 to-accent/10">
                <th class="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                  <i class="fa-solid fa-clock mr-2 text-primary"></i>æ“ä½œæ—¶é—´
                </th>
                <th class="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                  <i class="fa-solid fa-user-shield mr-2 text-primary"></i>æ“ä½œç®¡ç†å‘˜
                </th>
                <th class="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                  <i class="fa-solid fa-list mr-2 text-primary"></i>æ“ä½œç±»å‹
                </th>
                <th class="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                  <i class="fa-solid fa-user mr-2 text-primary"></i>ç›®æ ‡ç”¨æˆ·
                </th>
                <th class="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                  <i class="fa-solid fa-user-tag mr-2 text-primary"></i>ç”¨æˆ·è§’è‰²
                </th>
                <th class="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                  <i class="fa-solid fa-info-circle mr-2 text-primary"></i>æ“ä½œè¯¦æƒ…
                </th>
                <th class="px-4 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                  <i class="fa-solid fa-check-circle mr-2 text-primary"></i>çŠ¶æ€
                </th>
              </tr>
            </thead>
            <tbody id="logsTableBody" class="bg-white divide-y divide-gray-100">
              <!-- æ—¥å¿—å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
            </tbody>
          </table>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div id="logsEmpty" class="hidden text-center py-20">
          <div class="inline-block p-8 rounded-3xl bg-gradient-to-br from-gray-50 to-gray-100 mb-6 shadow-inner">
            <i class="fa-solid fa-inbox text-7xl text-gray-300"></i>
          </div>
          <h3 class="text-2xl font-bold text-gray-700 mb-2">æš‚æ— æ“ä½œè®°å½•</h3>
          <p class="text-gray-400 mb-4">å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ“ä½œæ—¥å¿—</p>
          <button onclick="document.getElementById('refreshLogsBtn').click()" class="px-6 py-2.5 bg-primary/10 hover:bg-primary text-primary hover:text-white rounded-xl font-medium transition-all">
            <i class="fa-solid fa-arrows-rotate mr-2"></i>é‡æ–°åŠ è½½
          </button>
        </div>
      </div>
    </div>

    <!-- ä¸ªäººä¿¡æ¯é¡µé¢ -->
    <div id="page-profile" class="page-content hidden">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- å·¦ä¾§ï¼šä¸ªäººä¿¡æ¯ -->
        <div class="lg:col-span-2 space-y-6">
          <div class="glass-card rounded-3xl p-8 hover-lift">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-gray-800 flex items-center">
                <i class="fa-solid fa-user-circle mr-3 text-primary text-2xl"></i>ä¸ªäººä¿¡æ¯
              </h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="group flex items-center p-4 rounded-xl hover:bg-primary/5 transition-all">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-accent/10 flex items-center justify-center mr-4 group-hover:scale-110 transition-transform">
                  <i class="fa-solid fa-id-badge text-primary text-lg"></i>
                </div>
                <div>
                  <p class="text-sm text-gray-500">å·¥å·</p>
                  <p id="profileAccount" class="text-lg font-bold text-gray-800">åŠ è½½ä¸­...</p>
                </div>
              </div>
              <div class="group flex items-center p-4 rounded-xl hover:bg-primary/5 transition-all">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-accent/10 flex items-center justify-center mr-4 group-hover:scale-110 transition-transform">
                  <i class="fa-solid fa-user text-primary text-lg"></i>
                </div>
                <div>
                  <p class="text-sm text-gray-500">å§“å</p>
                  <p id="profileName" class="text-lg font-bold text-gray-800">åŠ è½½ä¸­...</p>
                </div>
              </div>
              <div class="group flex items-center p-4 rounded-xl hover:bg-primary/5 transition-all">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-accent/10 flex items-center justify-center mr-4 group-hover:scale-110 transition-transform">
                  <i class="fa-solid fa-user-tag text-primary text-lg"></i>
                </div>
                <div>
                  <p class="text-sm text-gray-500">è§’è‰²</p>
                  <p id="profileRole" class="text-lg font-bold text-gray-800">ç®¡ç†å‘˜</p>
                </div>
              </div>
              <div class="group flex items-center p-4 rounded-xl hover:bg-primary/5 transition-all">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-accent/10 flex items-center justify-center mr-4 group-hover:scale-110 transition-transform">
                  <i class="fa-solid fa-shield-halved text-primary text-lg"></i>
                </div>
                <div>
                  <p class="text-sm text-gray-500">æƒé™çº§åˆ«</p>
                  <p class="text-lg font-bold text-gray-800">æœ€é«˜æƒé™</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- å³ä¾§ï¼šå¤´åƒå’Œå¿«æ·æ“ä½œ -->
        <div class="space-y-6">
          <div class="glass-card rounded-3xl p-6 text-center card-3d">
            <div class="relative inline-block mb-4 group">
              <!-- å‘å…‰èƒŒæ™¯ -->
              <div class="absolute -inset-2 bg-gradient-to-r from-primary via-accent to-primary-light rounded-3xl blur-lg opacity-30 group-hover:opacity-50 transition-opacity"></div>
              
              <!-- å¤´åƒå®¹å™¨ -->
              <div class="relative cursor-pointer" onclick="document.getElementById('avatarInput').click()">
                <div id="profileAvatarLarge" class="relative w-32 h-32 rounded-2xl bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white text-4xl font-bold shadow-xl overflow-hidden group-hover:scale-105 transition-transform">
                  <img id="avatarPreview" class="hidden w-full h-full object-cover" />
                  <span id="avatarText">A</span>
                </div>
                
                <!-- æ‚¬åœæç¤º -->
                <div class="absolute inset-0 bg-black/50 rounded-2xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-sm">
                  <div class="text-white text-center">
                    <i class="fa-solid fa-camera text-2xl mb-1"></i>
                    <p class="text-xs font-medium">æ›´æ¢å¤´åƒ</p>
                  </div>
                </div>
                
                <!-- åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-4 border-white shadow-lg animate-pulse"></div>
              </div>
              
              <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
              <input type="file" id="avatarInput" accept="image/*" class="hidden" onchange="handleAvatarChange(event)">
            </div>
            
            <h4 id="profileNameDisplay" class="font-bold text-xl text-gray-800 glow-text">ç®¡ç†å‘˜</h4>
            <p class="text-primary font-medium">ç³»ç»Ÿç®¡ç†å‘˜</p>
            
            <div class="mt-6 pt-4 border-t border-gray-100">
              <p id="profileAccountDisplay" class="text-xs text-gray-400">å·¥å·ï¼š--</p>
            </div>
          </div>
          
          <!-- å¿«æ·æ“ä½œ -->
          <div class="glass-card rounded-3xl p-6 card-3d">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center">
              <i class="fa-solid fa-bolt mr-2 text-accent"></i>å¿«æ·æ“ä½œ
            </h4>
            <div class="space-y-3">
              <button onclick="switchTab('management')" class="group w-full p-4 rounded-xl bg-gradient-to-r from-primary/10 to-accent/10 text-primary hover:from-primary hover:to-accent hover:text-white transition-all duration-300 text-left flex items-center justify-between border-2 border-primary/20 hover:border-primary hover:shadow-lg hover:scale-105">
                <div class="flex items-center">
                  <div class="w-10 h-10 rounded-lg bg-primary/20 group-hover:bg-white/20 flex items-center justify-center mr-3 transition-all">
                    <i class="fa-solid fa-users-gear text-lg"></i>
                  </div>
                  <span class="font-semibold">è¿”å›ç”¨æˆ·ç®¡ç†</span>
                </div>
                <i class="fa-solid fa-arrow-right text-sm group-hover:translate-x-1 transition-transform"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- æ“ä½œæ¨¡æ€æ¡† -->
  <div id="actionModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-card rounded-3xl w-full max-w-3xl max-h-[90vh] overflow-hidden animate-scaleIn shadow-2xl">
      <!-- æ¨¡æ€æ¡†æ ‡é¢˜ - æ¸å˜èƒŒæ™¯ -->
      <div class="relative bg-gradient-to-r from-primary via-primary-light to-accent p-6 overflow-hidden">
        <!-- è£…é¥°æ€§èƒŒæ™¯å…ƒç´  -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
        
        <!-- æ ‡é¢˜å†…å®¹ -->
        <div class="relative flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
              <i id="modalIcon" class="fa-solid fa-cog text-white text-xl"></i>
            </div>
            <div>
              <h3 id="modalTitle" class="text-2xl font-bold text-white drop-shadow-lg">æ“ä½œçª—å£</h3>
              <p id="modalSubtitle" class="text-sm text-white/80 mt-0.5">è¯·å¡«å†™ç›¸å…³ä¿¡æ¯</p>
            </div>
          </div>
          <button id="closeModal" class="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 backdrop-blur-sm flex items-center justify-center text-white transition-all hover:scale-110">
            <i class="fa-solid fa-xmark text-xl"></i>
          </button>
        </div>
      </div>
      
      <!-- æ¨¡æ€æ¡†å†…å®¹ -->
      <div id="modalBody" class="p-8 overflow-y-auto custom-scrollbar bg-gradient-to-b from-gray-50/50 to-white" style="max-height: calc(90vh - 140px);">
        <div class="text-center py-12 text-gray-400">
          <div class="inline-block p-4 rounded-2xl bg-primary/5 mb-4">
            <i class="fa-solid fa-spinner fa-spin text-3xl text-primary"></i>
          </div>
          <p class="text-lg font-medium">åŠ è½½ä¸­...</p>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center py-6 text-gray-500 text-sm">
    å­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿ &copy; 2023
  </footer>

  <script>
    // Toastæç¤ºå‡½æ•°
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `fixed top-20 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 transition-opacity ${type === 'success' ? 'bg-primary text-white' : 'bg-red-500 text-white'}`;
      toast.style.opacity = '1';
      toast.style.pointerEvents = 'auto';
      setTimeout(() => { toast.style.opacity = '0'; toast.style.pointerEvents = 'none'; }, 3000);
    }

    // é¡µé¢åˆ‡æ¢å‡½æ•°
    function switchTab(tabName) {
      // éšè—æ‰€æœ‰é¡µé¢
      document.querySelectorAll('.page-content').forEach(page => {
        page.classList.add('hidden');
      });
      
      // ç§»é™¤æ‰€æœ‰tabçš„æ¿€æ´»çŠ¶æ€
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('text-primary', 'bg-white', 'shadow-md');
        tab.classList.add('text-gray-600');
      });
      
      // æ˜¾ç¤ºé€‰ä¸­çš„é¡µé¢
      if (tabName === 'management') {
        document.getElementById('page-management').classList.remove('hidden');
        document.getElementById('tab-management').classList.add('text-primary', 'bg-white', 'shadow-md');
        document.getElementById('tab-management').classList.remove('text-gray-600');
        document.getElementById('pageTitle').textContent = 'ç³»ç»Ÿç®¡ç†';
        document.getElementById('pageSubtitle').textContent = 'ç®¡ç†ç³»ç»Ÿç”¨æˆ·å’ŒæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯';
      } else if (tabName === 'logs') {
        document.getElementById('page-logs').classList.remove('hidden');
        document.getElementById('tab-logs').classList.add('text-primary', 'bg-white', 'shadow-md');
        document.getElementById('tab-logs').classList.remove('text-gray-600');
        document.getElementById('pageTitle').textContent = 'å·¥ä½œè®°å½•';
        document.getElementById('pageSubtitle').textContent = 'æŸ¥çœ‹ç®¡ç†å‘˜æ“ä½œæ—¥å¿—å’Œå®¡è®¡è®°å½•';
        loadOperationLogs(); // åŠ è½½æ—¥å¿—æ•°æ®
      } else if (tabName === 'profile') {
        document.getElementById('page-profile').classList.remove('hidden');
        document.getElementById('tab-profile').classList.add('text-primary', 'bg-white', 'shadow-md');
        document.getElementById('tab-profile').classList.remove('text-gray-600');
        document.getElementById('pageTitle').textContent = 'ä¸ªäººä¿¡æ¯';
        document.getElementById('pageSubtitle').textContent = 'æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„ä¸ªäººèµ„æ–™';
      }
    }

    // åŠ è½½æ“ä½œæ—¥å¿—
    async function loadOperationLogs() {
      const logsLoading = document.getElementById('logsLoading');
      const logsTableContainer = document.getElementById('logsTableContainer');
      const logsEmpty = document.getElementById('logsEmpty');
      const logsTableBody = document.getElementById('logsTableBody');
      const logsCount = document.getElementById('logsCount');
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      logsLoading.classList.remove('hidden');
      logsTableContainer.classList.add('hidden');
      logsEmpty.classList.add('hidden');
      
      try {
        // è·å–ç­›é€‰æ¡ä»¶
        const operationType = document.getElementById('filterOperationType').value;
        const userRole = document.getElementById('filterUserRole').value;
        const timeRange = document.getElementById('filterTimeRange').value;
        
        // æ„å»ºæŸ¥è¯¢å‚æ•°
        const params = new URLSearchParams();
        if (operationType) params.append('operation_type', operationType);
        if (userRole) params.append('user_role', userRole);
        if (timeRange) params.append('time_range', timeRange);
        
        const response = await fetch(`/api/admin/operation-logs?${params.toString()}`);
        const result = await response.json();
        
        logsLoading.classList.add('hidden');
        
        if (result.success && result.data && result.data.length > 0) {
          // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
          const stats = {
            total: result.data.length,
            add: result.data.filter(log => log.operation_type === 'ADD').length,
            update: result.data.filter(log => log.operation_type === 'UPDATE').length,
            delete: result.data.filter(log => log.operation_type === 'DELETE').length
          };
          
          document.getElementById('statTotal').textContent = stats.total;
          document.getElementById('statAdd').textContent = stats.add;
          document.getElementById('statUpdate').textContent = stats.update;
          document.getElementById('statDelete').textContent = stats.delete;
          
          // æ˜¾ç¤ºæ—¥å¿—è¡¨æ ¼
          logsTableContainer.classList.remove('hidden');
          logsCount.innerHTML = `<span class="text-sm font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">å…± ${result.data.length} æ¡è®°å½•</span>`;
          
          // æ¸²æŸ“æ—¥å¿—æ•°æ®
          logsTableBody.innerHTML = result.data.map(log => {
            const operationTypeMap = {
              'ADD': { text: 'æ–°å¢ç”¨æˆ·', color: 'green', icon: 'fa-user-plus' },
              'UPDATE': { text: 'ä¿®æ”¹ç”¨æˆ·', color: 'blue', icon: 'fa-user-pen' },
              'DELETE': { text: 'åˆ é™¤ç”¨æˆ·', color: 'red', icon: 'fa-user-xmark' },
              'VIEW': { text: 'æŸ¥çœ‹ä¿¡æ¯', color: 'gray', icon: 'fa-eye' }
            };
            
            const roleMap = {
              'student': { text: 'å­¦ç”Ÿ', color: 'blue' },
              'counselor': { text: 'è¾…å¯¼å‘˜', color: 'purple' },
              'teacher': { text: 'æ•™å¸ˆ', color: 'amber' },
              'admin': { text: 'ç®¡ç†å‘˜', color: 'red' }
            };
            
            const operation = operationTypeMap[log.operation_type] || { text: log.operation_type, color: 'gray', icon: 'fa-question' };
            const role = roleMap[log.target_user_role] || { text: log.target_user_role, color: 'gray' };
            const statusColor = log.status === 'SUCCESS' ? 'green' : 'red';
            
            return `
              <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-4 py-4 text-sm text-gray-700">
                  <div class="flex items-center">
                    <i class="fa-solid fa-clock mr-2 text-gray-400"></i>
                    ${new Date(log.operation_time).toLocaleString('zh-CN')}
                  </div>
                </td>
                <td class="px-4 py-4">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center mr-2">
                      <i class="fa-solid fa-user-shield text-primary text-sm"></i>
                    </div>
                    <div>
                      <div class="font-semibold text-gray-800 text-sm">${log.admin_name || '-'}</div>
                      <div class="text-xs text-gray-500">${log.admin_account}</div>
                    </div>
                  </div>
                </td>
                <td class="px-4 py-4">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-${operation.color}-100 text-${operation.color}-700">
                    <i class="fa-solid ${operation.icon} mr-1"></i>
                    ${operation.text}
                  </span>
                </td>
                <td class="px-4 py-4">
                  <div class="text-sm">
                    <div class="font-semibold text-gray-800">${log.target_user_name || '-'}</div>
                    <div class="text-xs text-gray-500">${log.target_user_account || '-'}</div>
                  </div>
                </td>
                <td class="px-4 py-4">
                  <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-${role.color}-100 text-${role.color}-700">
                    ${role.text}
                  </span>
                </td>
                <td class="px-4 py-4 text-sm text-gray-600 max-w-xs truncate" title="${log.operation_details || '-'}">
                  ${log.operation_details || '-'}
                </td>
                <td class="px-4 py-4">
                  <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-semibold bg-${statusColor}-100 text-${statusColor}-700">
                    <i class="fa-solid fa-${log.status === 'SUCCESS' ? 'check' : 'xmark'}-circle mr-1"></i>
                    ${log.status === 'SUCCESS' ? 'æˆåŠŸ' : 'å¤±è´¥'}
                  </span>
                </td>
              </tr>
            `;
          }).join('');
          
        } else {
          // æ˜¾ç¤ºç©ºçŠ¶æ€
          logsEmpty.classList.remove('hidden');
          logsCount.innerHTML = `<span class="text-sm font-bold text-primary">å…± 0 æ¡è®°å½•</span>`;
        }
        
      } catch (error) {
        console.error('åŠ è½½æ—¥å¿—å¤±è´¥:', error);
        logsLoading.classList.add('hidden');
        logsEmpty.classList.remove('hidden');
        logsCount.innerHTML = `<span class="text-sm font-bold text-red-600">åŠ è½½å¤±è´¥</span>`;
      }
    }

    // ç»‘å®šåˆ·æ–°å’Œç­›é€‰äº‹ä»¶
    document.addEventListener('DOMContentLoaded', function() {
      // åˆ·æ–°æŒ‰é’®
      const refreshBtn = document.getElementById('refreshLogsBtn');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', loadOperationLogs);
      }
      
      // ç­›é€‰å™¨å˜åŒ–æ—¶é‡æ–°åŠ è½½
      const filters = ['filterOperationType', 'filterUserRole', 'filterTimeRange'];
      filters.forEach(filterId => {
        const filter = document.getElementById(filterId);
        if (filter) {
          filter.addEventListener('change', loadOperationLogs);
        }
      });
    });

    // é¡µé¢åŠ è½½æ—¶è·å–ç”¨æˆ·ä¿¡æ¯
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        const response = await fetch('/api/check_login');
        const result = await response.json();
        
        if (!result.logged_in || result.user_info.role_name !== 'ç®¡ç†å‘˜') {
          window.location.href = '/login';
          return;
        }
        
        // æ˜¾ç¤ºç”¨æˆ·å
        document.getElementById('userName').textContent = result.user_info.user_name;
        
        // æ›´æ–°ä¸ªäººä¿¡æ¯é¡µé¢æ•°æ®
        const userAccount = result.user_info.user_account;
        const userName = result.user_info.user_name;
        const firstLetter = userName.charAt(0).toUpperCase();
        
        document.getElementById('profileAccount').textContent = userAccount;
        document.getElementById('profileName').textContent = userName;
        document.getElementById('profileNameDisplay').textContent = userName;
        document.getElementById('profileAccountDisplay').textContent = `å·¥å·ï¼š${userAccount}`;
        document.getElementById('profileAvatarLarge').textContent = firstLetter;
        
        // ç»‘å®šèœå•ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('[data-action]').forEach(card => {
          card.addEventListener('click', function() {
            const action = this.getAttribute('data-action');
            showActionModal(action);
          });
        });
        
        // ç»‘å®šé€€å‡ºç™»å½•äº‹ä»¶
        document.getElementById('logoutBtn').addEventListener('click', async function() {
          if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
            await fetch('/api/logout', { method: 'POST' });
            window.location.href = '/login';
          }
        });
        
        // ç»‘å®šå…³é—­æ¨¡æ€æ¡†äº‹ä»¶
        document.getElementById('closeModal').addEventListener('click', function() {
          document.getElementById('actionModal').classList.add('hidden');
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
          const modal = document.getElementById('actionModal');
          if (event.target === modal) {
            modal.classList.add('hidden');
          }
        });
        
      } catch (error) {
        console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
        alert('ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
        window.location.href = '/login';
      }
    });
        
        // æ˜¾ç¤ºæ“ä½œæ¨¡æ€æ¡†
        async function showActionModal(action) {
            const modal = document.getElementById('actionModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalIcon = document.getElementById('modalIcon');
            const modalBody = document.getElementById('modalBody');
            
            // æ¸…ç©ºä¹‹å‰çš„æ¶ˆæ¯
            modalBody.innerHTML = '<div class="message"></div>åŠ è½½ä¸­...';
            
            // æ ¹æ®ä¸åŒæ“ä½œè®¾ç½®æ ‡é¢˜å’Œå†…å®¹
            switch(action) {
                case 'view-students':
                    modalTitle.textContent = 'æŸ¥çœ‹å­¦ç”Ÿä¿¡æ¯';
                    modalSubtitle.textContent = 'æµè§ˆæ‰€æœ‰å­¦ç”Ÿè´¦æˆ·ä¿¡æ¯';
                    modalIcon.className = 'fa-solid fa-user-graduate text-white text-xl';
                    await loadUserData(modalBody, 'student');
                    break;
                case 'view-teachers':
                    modalTitle.textContent = 'æŸ¥çœ‹æ•™å¸ˆä¿¡æ¯';
                    modalSubtitle.textContent = 'æµè§ˆæ‰€æœ‰æ•™å¸ˆè´¦æˆ·ä¿¡æ¯';
                    modalIcon.className = 'fa-solid fa-chalkboard-user text-white text-xl';
                    await loadUserData(modalBody, 'teacher');
                    break;
                case 'view-counselors':
                    modalTitle.textContent = 'æŸ¥çœ‹è¾…å¯¼å‘˜ä¿¡æ¯';
                    modalSubtitle.textContent = 'æµè§ˆæ‰€æœ‰è¾…å¯¼å‘˜è´¦æˆ·ä¿¡æ¯';
                    modalIcon.className = 'fa-solid fa-user-tie text-white text-xl';
                    await loadUserData(modalBody, 'counselor');
                    break;
                case 'view-admins':
                    modalTitle.textContent = 'æŸ¥çœ‹ç®¡ç†å‘˜ä¿¡æ¯';
                    modalSubtitle.textContent = 'æµè§ˆæ‰€æœ‰ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯';
                    modalIcon.className = 'fa-solid fa-user-shield text-white text-xl';
                    await loadUserData(modalBody, 'admin');
                    break;
                case 'add-user':
                    modalTitle.textContent = 'æ–°å¢ç”¨æˆ·';
                    modalSubtitle.textContent = 'åˆ›å»ºæ–°çš„ç”¨æˆ·è´¦æˆ·';
                    modalIcon.className = 'fa-solid fa-user-plus text-white text-xl';
                    modalBody.innerHTML = `
                        <div class="message hidden mb-4 p-4 rounded-xl"></div>
                        <form id="addUserForm" class="space-y-5">
                            <div class="bg-gradient-to-r from-primary/5 to-accent/5 rounded-2xl p-6 border border-primary/10">
                                <div class="flex items-center mb-4">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-user-tag text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">ç”¨æˆ·ç±»å‹</h4>
                                </div>
                                <select id="addUserType" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all text-gray-700 font-medium" required>
                                    <option value="">è¯·é€‰æ‹©ç”¨æˆ·ç±»å‹</option>
                                    <option value="student">ğŸ‘¨â€ğŸ“ å­¦ç”Ÿ</option>
                                    <option value="teacher">ğŸ‘¨â€ğŸ« æ•™å¸ˆ</option>
                                    <option value="counselor">ğŸ‘” è¾…å¯¼å‘˜</option>
                                    <option value="admin">ğŸ›¡ï¸ ç®¡ç†å‘˜</option>
                                </select>
                            </div>
                            
                            <div class="relative">
                                <label for="addAccount" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fa-solid fa-id-card mr-2 text-primary"></i>è´¦å·
                                </label>
                                <input type="text" id="addAccount" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all" placeholder="è¯·è¾“å…¥è´¦å·" required>
                                <i class="fa-solid fa-hashtag absolute left-4 top-[42px] text-gray-400"></i>
                                <p class="text-xs text-gray-500 mt-2 ml-1 flex items-center">
                                    <i class="fa-solid fa-circle-info mr-1 text-primary"></i>
                                    è§„åˆ™ï¼š4ä½(ç®¡ç†å‘˜) / 8ä½(è¾…å¯¼å‘˜) / 9ä½(æ•™å¸ˆ) / 12ä½(å­¦ç”Ÿ)
                                </p>
                            </div>
                            
                            <div class="relative">
                                <label for="addName" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fa-solid fa-user mr-2 text-primary"></i>å§“å
                                </label>
                                <input type="text" id="addName" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all" placeholder="è¯·è¾“å…¥å§“å" required>
                                <i class="fa-solid fa-signature absolute left-4 top-[42px] text-gray-400"></i>
                            </div>
                            
                            <div class="relative">
                                <label for="addPassword" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fa-solid fa-lock mr-2 text-primary"></i>å¯†ç 
                                </label>
                                <input type="password" id="addPassword" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all" placeholder="è¯·è¾“å…¥å¯†ç " required>
                                <i class="fa-solid fa-key absolute left-4 top-[42px] text-gray-400"></i>
                            </div>
                            
                            <!-- å­¦ç”Ÿé¢å¤–å±æ€§ -->
                            <div id="studentFields" class="hidden bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-graduation-cap text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">å­¦ç”Ÿä¿¡æ¯</h4>
                                </div>
                                
                                <div>
                                    <label for="addDept" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-blue-600"></i>éƒ¨é—¨/é™¢ç³»
                                    </label>
                                    <select id="addDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="addGrade" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-calendar mr-2 text-blue-600"></i>å¹´çº§
                                    </label>
                                    <select id="addGrade" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©å¹´çº§</option>
                                        <option value="2024çº§">2024çº§</option>
                                        <option value="2023çº§">2023çº§</option>
                                        <option value="2022çº§">2022çº§</option>
                                        <option value="2021çº§">2021çº§</option>
                                        <option value="2020çº§">2020çº§</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="addMajor" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-book mr-2 text-blue-600"></i>ä¸“ä¸š
                                    </label>
                                    <select id="addMajor" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©ä¸“ä¸š</option>
                                        <option value="è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</option>
                                        <option value="è½¯ä»¶å·¥ç¨‹">è½¯ä»¶å·¥ç¨‹</option>
                                        <option value="ç½‘ç»œå·¥ç¨‹">ç½‘ç»œå·¥ç¨‹</option>
                                        <option value="ä¿¡æ¯å®‰å…¨">ä¿¡æ¯å®‰å…¨</option>
                                        <option value="æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯">æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯</option>
                                        <option value="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½</option>
                                        <option value="ç‰©è”ç½‘å·¥ç¨‹">ç‰©è”ç½‘å·¥ç¨‹</option>
                                        <option value="ç”µå­ä¿¡æ¯å·¥ç¨‹">ç”µå­ä¿¡æ¯å·¥ç¨‹</option>
                                        <option value="é€šä¿¡å·¥ç¨‹">é€šä¿¡å·¥ç¨‹</option>
                                        <option value="è‡ªåŠ¨åŒ–">è‡ªåŠ¨åŒ–</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="addClassNum" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-users mr-2 text-blue-600"></i>ç­çº§
                                    </label>
                                    <select id="addClassNum" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©ç­çº§</option>
                                        <option value="01">01ç­</option>
                                        <option value="02">02ç­</option>
                                        <option value="03">03ç­</option>
                                        <option value="04">04ç­</option>
                                        <option value="05">05ç­</option>
                                        <option value="06">06ç­</option>
                                        <option value="07">07ç­</option>
                                        <option value="08">08ç­</option>
                                        <option value="09">09ç­</option>
                                        <option value="10">10ç­</option>
                                    </select>
                                </div>
                                
                                <div class="relative">
                                    <label for="addContact" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-phone mr-2 text-blue-600"></i>è”ç³»æ–¹å¼
                                    </label>
                                    <input type="text" id="addContact" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all" placeholder="ä¾‹å¦‚ï¼š13800138001">
                                    <i class="fa-solid fa-phone absolute left-4 top-[42px] text-gray-400"></i>
                                </div>
                            </div>
                            
                            <!-- è¾…å¯¼å‘˜é¢å¤–å±æ€§ -->
                            <div id="counselorFields" class="hidden bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-user-tie text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">è¾…å¯¼å‘˜ä¿¡æ¯</h4>
                                </div>
                                
                                <div>
                                    <label for="addCounselorDept" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-purple-600"></i>éƒ¨é—¨/é™¢ç³»
                                    </label>
                                    <select id="addCounselorDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="addCounselorGrade" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-calendar mr-2 text-purple-600"></i>è´Ÿè´£å¹´çº§
                                    </label>
                                    <select id="addCounselorGrade" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©è´Ÿè´£å¹´çº§</option>
                                        <option value="2024">2024çº§</option>
                                        <option value="2023">2023çº§</option>
                                        <option value="2022">2022çº§</option>
                                        <option value="2021">2021çº§</option>
                                        <option value="2020">2020çº§</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="addCounselorMajor" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-book mr-2 text-purple-600"></i>è´Ÿè´£ä¸“ä¸š
                                    </label>
                                    <select id="addCounselorMajor" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©è´Ÿè´£ä¸“ä¸š</option>
                                        <option value="è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</option>
                                        <option value="è½¯ä»¶å·¥ç¨‹">è½¯ä»¶å·¥ç¨‹</option>
                                        <option value="ç½‘ç»œå·¥ç¨‹">ç½‘ç»œå·¥ç¨‹</option>
                                        <option value="ä¿¡æ¯å®‰å…¨">ä¿¡æ¯å®‰å…¨</option>
                                        <option value="æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯">æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯</option>
                                        <option value="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½</option>
                                        <option value="ç‰©è”ç½‘å·¥ç¨‹">ç‰©è”ç½‘å·¥ç¨‹</option>
                                        <option value="ç”µå­ä¿¡æ¯å·¥ç¨‹">ç”µå­ä¿¡æ¯å·¥ç¨‹</option>
                                        <option value="é€šä¿¡å·¥ç¨‹">é€šä¿¡å·¥ç¨‹</option>
                                        <option value="è‡ªåŠ¨åŒ–">è‡ªåŠ¨åŒ–</option>
                                    </select>
                                </div>
                                
                                <div class="relative">
                                    <label for="addCounselorContact" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-phone mr-2 text-purple-600"></i>è”ç³»æ–¹å¼
                                    </label>
                                    <input type="text" id="addCounselorContact" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all" placeholder="ä¾‹å¦‚ï¼š13800138001">
                                    <i class="fa-solid fa-phone absolute left-4 top-[42px] text-gray-400"></i>
                                </div>
                            </div>
                            
                            <!-- æ•™å¸ˆé¢å¤–å±æ€§ -->
                            <div id="teacherFields" class="hidden bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border-2 border-amber-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-chalkboard-user text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">æ•™å¸ˆä¿¡æ¯</h4>
                                </div>
                                
                                <div>
                                    <label for="addTeacherDept" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-amber-600"></i>éƒ¨é—¨/é™¢ç³»
                                    </label>
                                    <select id="addTeacherDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-amber-500/30 focus:border-amber-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                                
                                <div class="relative">
                                    <label for="addTeacherContact" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-phone mr-2 text-amber-600"></i>è”ç³»æ–¹å¼
                                    </label>
                                    <input type="text" id="addTeacherContact" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-amber-500/30 focus:border-amber-500 transition-all" placeholder="ä¾‹å¦‚ï¼š13800138001">
                                    <i class="fa-solid fa-phone absolute left-4 top-[42px] text-gray-400"></i>
                                </div>
                            </div>
                            
                            <!-- ç®¡ç†å‘˜é¢å¤–å±æ€§ -->
                            <div id="adminFields" class="hidden bg-gradient-to-r from-red-50 to-rose-50 rounded-2xl p-6 border-2 border-red-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-user-shield text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">ç®¡ç†å‘˜ä¿¡æ¯</h4>
                                </div>
                                
                                <div>
                                    <label for="addAdminDept" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-red-600"></i>éƒ¨é—¨/é™¢ç³»
                                    </label>
                                    <select id="addAdminDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-red-500/30 focus:border-red-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="pt-4 flex gap-3">
                                <button type="submit" class="flex-1 py-3.5 bg-gradient-to-r from-primary to-accent text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all btn-glow flex items-center justify-center">
                                    <i class="fa-solid fa-user-plus mr-2"></i>ç¡®è®¤æ–°å¢
                                </button>
                                <button type="button" onclick="document.getElementById('addUserForm').reset()" class="px-6 py-3.5 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-all flex items-center justify-center">
                                    <i class="fa-solid fa-rotate-left mr-2"></i>é‡ç½®
                                </button>
                            </div>
                        </form>
                    `;
                    
                    // ç›‘å¬ç”¨æˆ·ç±»å‹é€‰æ‹©å˜åŒ–
                    document.getElementById('addUserType').addEventListener('change', async function() {
                        const studentFields = document.getElementById('studentFields');
                        const counselorFields = document.getElementById('counselorFields');
                        const teacherFields = document.getElementById('teacherFields');
                        const adminFields = document.getElementById('adminFields');
                        
                        // éšè—æ‰€æœ‰é¢å¤–å­—æ®µ
                        studentFields.classList.add('hidden');
                        counselorFields.classList.add('hidden');
                        teacherFields.classList.add('hidden');
                        adminFields.classList.add('hidden');
                        
                        // æ ¹æ®é€‰æ‹©æ˜¾ç¤ºå¯¹åº”å­—æ®µ
                        if (this.value === 'student') {
                            studentFields.classList.remove('hidden');
                        } else if (this.value === 'counselor') {
                            counselorFields.classList.remove('hidden');
                        } else if (this.value === 'teacher') {
                            teacherFields.classList.remove('hidden');
                        } else if (this.value === 'admin') {
                            adminFields.classList.remove('hidden');
                        }
                    });
                    
                    // æäº¤è¡¨å•ç»‘å®šæ–°å¢ç”¨æˆ·è¡¨å•æäº¤äº‹ä»¶
                    document.getElementById('addUserForm').addEventListener('submit', async function(e) {
                        e.preventDefault();
                        const userType = document.getElementById('addUserType').value;
                        const account = document.getElementById('addAccount').value;
                        const name = document.getElementById('addName').value;
                        const password = document.getElementById('addPassword').value;
                        
                        // è§’è‰²ç±»å‹æ˜ å°„ (1=å­¦ç”Ÿï¼Œ2=è¾…å¯¼å‘˜ï¼Œ3=è®²å¸ˆï¼Œ4=ç®¡ç†å‘˜)
                        const roleMap = {
                            'student': 1,
                            'counselor': 2,
                            'teacher': 3,
                            'admin': 4
                        };
                        
                        // å‡†å¤‡æäº¤æ•°æ®
                        const userData = {
                            account,
                            user_name: name,
                            password,
                            role_type: roleMap[userType]
                        };
                        
                        // å¦‚æœæ˜¯å­¦ç”Ÿï¼Œæ·»åŠ é¢å¤–å±æ€§
                        if (userType === 'student') {
                            const dept = document.getElementById('addDept').value.trim();
                            const grade = document.getElementById('addGrade').value.trim();
                            const major = document.getElementById('addMajor').value.trim();
                            const classNum = document.getElementById('addClassNum').value.trim();
                            const contact = document.getElementById('addContact').value.trim();
                            
                            if (dept) userData.dept = dept;
                            if (grade) userData.grade = grade;
                            if (major) userData.major = major;
                            if (classNum) userData.class_num = classNum;
                            if (contact) userData.contact = contact;
                        }
                        // å¦‚æœæ˜¯è¾…å¯¼å‘˜ï¼Œæ·»åŠ é¢å¤–å±æ€§
                        else if (userType === 'counselor') {
                            const dept = document.getElementById('addCounselorDept').value.trim();
                            const responsibleGrade = document.getElementById('addCounselorGrade').value.trim();
                            const responsibleMajor = document.getElementById('addCounselorMajor').value.trim();
                            const contact = document.getElementById('addCounselorContact').value.trim();
                            
                            if (dept) userData.dept = dept;
                            if (responsibleGrade) userData.responsible_grade = responsibleGrade;
                            if (responsibleMajor) userData.responsible_major = responsibleMajor;
                            if (contact) userData.contact = contact;
                        }
                        // å¦‚æœæ˜¯æ•™å¸ˆï¼Œæ·»åŠ é¢å¤–å±æ€§
                        else if (userType === 'teacher') {
                            const dept = document.getElementById('addTeacherDept').value.trim();
                            const contact = document.getElementById('addTeacherContact').value.trim();
                            
                            if (dept) userData.dept = dept;
                            if (contact) userData.contact = contact;
                        }
                        // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ·»åŠ é¢å¤–å±æ€§
                        else if (userType === 'admin') {
                            const dept = document.getElementById('addAdminDept').value.trim();
                            
                            if (dept) userData.dept = dept;
                        }
                        
                        try {
                            const response = await fetch('/api/admin/users', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(userData)
                            });
                            
                            const result = await response.json();
                            const messageEl = modalBody.querySelector('.message');
                            messageEl.classList.remove('hidden');
                            // æ˜¾ç¤ºæ¶ˆæ¯
                            if (result.success) {
                                messageEl.textContent = result.message;
                                messageEl.className = 'message message-success';
                                // æ¸…ç©ºè¡¨å•å¹¶éšè—å­¦ç”Ÿå­—æ®µ
                                this.reset();
                                document.getElementById('studentFields').classList.add('hidden');
                            } else {
                                messageEl.textContent = result.message;
                                messageEl.className = 'message message-error';
                            }
                        } catch (error) {
                            console.error('æ–°å¢ç”¨æˆ·å¤±è´¥:', error);
                            const messageEl = modalBody.querySelector('.message');
                            messageEl.classList.remove('hidden');
                            messageEl.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•';
                            messageEl.className = 'message message-error';
                        }
                    });
                    break;
                case 'update-user':
                    modalTitle.textContent = 'ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯';
                    modalSubtitle.textContent = 'ç¼–è¾‘ç°æœ‰ç”¨æˆ·çš„èµ„æ–™ä¿¡æ¯';
                    modalIcon.className = 'fa-solid fa-user-pen text-white text-xl';
                    modalBody.innerHTML = `
                        <div id="formMessage" class="hidden mb-4 p-4 rounded-xl"></div>
                        <form id="updateUserForm" class="space-y-5">
                            <div class="bg-gradient-to-r from-cyan/5 to-primary/5 rounded-2xl p-6 border-2 border-dashed border-cyan-200">
                                <div class="flex items-center mb-3">
                                    <i class="fa-solid fa-magnifying-glass text-cyan-600 text-xl mr-3"></i>
                                    <h4 class="font-bold text-gray-800">æŸ¥æ‰¾ç”¨æˆ·</h4>
                                </div>
                                <div class="flex gap-3">
                                    <div class="relative flex-1">
                                        <input type="text" id="updateAccount" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 transition-all font-medium" placeholder="è¯·è¾“å…¥è´¦å·" required>
                                        <i class="fa-solid fa-hashtag absolute left-4 top-3.5 text-gray-400"></i>
                                    </div>
                                    <button type="button" id="searchUserBtn" class="px-6 py-3 bg-gradient-to-r from-cyan-500 to-primary text-white rounded-xl font-semibold hover:shadow-lg transition-all flex items-center">
                                        <i class="fa-solid fa-search mr-2"></i>æŸ¥è¯¢
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
                            <div id="userInfoDisplay" class="hidden bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-200 cursor-pointer hover:shadow-lg hover:scale-[1.02] transition-all duration-300 group">
                                <div class="flex items-start">
                                    <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mr-4 flex-shrink-0 group-hover:scale-110 transition-transform">
                                        <i id="userRoleIcon" class="fa-solid fa-user text-white text-2xl"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-gray-800 mb-3 flex items-center justify-between">
                                            <div class="flex items-center">
                                                <span>å½“å‰ç”¨æˆ·ä¿¡æ¯</span>
                                                <span id="userRoleBadge" class="ml-3 px-3 py-1 text-xs rounded-full"></span>
                                            </div>
                                            <span class="text-cyan-600 text-sm font-normal flex items-center group-hover:text-cyan-700">
                                                <i class="fa-solid fa-hand-pointer mr-1"></i>ç‚¹å‡»ç¼–è¾‘
                                            </span>
                                        </h4>
                                        <div class="grid grid-cols-2 gap-3 text-sm">
                                            <div class="flex items-center">
                                                <span class="text-gray-600 font-medium w-20">è´¦å·ï¼š</span>
                                                <span id="displayAccount" class="font-semibold text-gray-800"></span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-gray-600 font-medium w-20">å§“åï¼š</span>
                                                <span id="displayName" class="font-semibold text-gray-800"></span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-gray-600 font-medium w-20">è§’è‰²ï¼š</span>
                                                <span id="displayRole" class="font-semibold text-gray-800"></span>
                                            </div>
                                            <div id="displayDeptContainer" class="hidden flex items-center">
                                                <span class="text-gray-600 font-medium w-20">éƒ¨é—¨ï¼š</span>
                                                <span id="displayDept" class="font-semibold text-gray-800"></span>
                                            </div>
                                            <div id="displayGradeContainer" class="hidden flex items-center">
                                                <span class="text-gray-600 font-medium w-20">å¹´çº§ï¼š</span>
                                                <span id="displayGrade" class="font-semibold text-gray-800"></span>
                                            </div>
                                            <div id="displayMajorContainer" class="hidden flex items-center">
                                                <span class="text-gray-600 font-medium w-20">ä¸“ä¸šï¼š</span>
                                                <span id="displayMajor" class="font-semibold text-gray-800"></span>
                                            </div>
                                            <div id="displayContactContainer" class="hidden flex items-center">
                                                <span class="text-gray-600 font-medium w-20">è”ç³»æ–¹å¼ï¼š</span>
                                                <span id="displayContact" class="font-semibold text-gray-800"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-amber-50/50 rounded-2xl p-5 border border-amber-200">
                                <div class="flex items-start">
                                    <i class="fa-solid fa-circle-info text-amber-600 text-lg mr-3 mt-0.5"></i>
                                    <div>
                                        <p class="font-semibold text-amber-800 mb-1">ä¿®æ”¹è¯´æ˜</p>
                                        <p class="text-sm text-amber-700">ä»¥ä¸‹å­—æ®µä¸ºå¯é€‰é¡¹ï¼Œç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹è¯¥é¡¹</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <label for="updateUserType" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fa-solid fa-user-tag mr-2 text-cyan-600"></i>æ–°ç”¨æˆ·ç±»å‹
                                    <span class="ml-2 text-xs text-gray-400">(å¯é€‰)</span>
                                </label>
                                <select id="updateUserType" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 transition-all text-gray-700">
                                    <option value="">ä¸ä¿®æ”¹</option>
                                    <option value="student">ğŸ‘¨â€ğŸ“ å­¦ç”Ÿ</option>
                                    <option value="teacher">ğŸ‘¨â€ğŸ« æ•™å¸ˆ</option>
                                    <option value="counselor">ğŸ‘” è¾…å¯¼å‘˜</option>
                                    <option value="admin">ğŸ›¡ï¸ ç®¡ç†å‘˜</option>
                                </select>
                            </div>
                            
                            <div class="relative">
                                <label for="updateName" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fa-solid fa-signature mr-2 text-cyan-600"></i>æ–°å§“å
                                    <span class="ml-2 text-xs text-gray-400">(å¯é€‰)</span>
                                </label>
                                <input type="text" id="updateName" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 transition-all" placeholder="è¯·è¾“å…¥æ–°å§“å">
                                <i class="fa-solid fa-user absolute left-4 top-[42px] text-gray-400"></i>
                            </div>
                            
                            <div class="relative">
                                <label for="updatePassword" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fa-solid fa-key mr-2 text-cyan-600"></i>æ–°å¯†ç 
                                    <span class="ml-2 text-xs text-gray-400">(å¯é€‰)</span>
                                </label>
                                <input type="password" id="updatePassword" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 transition-all" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
                                <i class="fa-solid fa-lock absolute left-4 top-[42px] text-gray-400"></i>
                            </div>
                            
                            <!-- å­¦ç”Ÿé¢å¤–å±æ€§ -->
                            <div id="updateStudentFields" class="hidden bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-graduation-cap text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">å­¦ç”Ÿä¿¡æ¯</h4>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-blue-600"></i>éƒ¨é—¨/é™¢ç³»
                                    </label>
                                    <select id="updateStudentDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-calendar mr-2 text-blue-600"></i>å¹´çº§
                                    </label>
                                    <select id="updateStudentGrade" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©å¹´çº§</option>
                                        <option value="2021">2021çº§</option>
                                        <option value="2022">2022çº§</option>
                                        <option value="2023">2023çº§</option>
                                        <option value="2024">2024çº§</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-book mr-2 text-blue-600"></i>ä¸“ä¸š
                                    </label>
                                    <select id="updateStudentMajor" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©ä¸“ä¸š</option>
                                        <option value="è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</option>
                                        <option value="è½¯ä»¶å·¥ç¨‹">è½¯ä»¶å·¥ç¨‹</option>
                                        <option value="ç½‘ç»œå·¥ç¨‹">ç½‘ç»œå·¥ç¨‹</option>
                                        <option value="ä¿¡æ¯å®‰å…¨">ä¿¡æ¯å®‰å…¨</option>
                                        <option value="æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯">æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯</option>
                                        <option value="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½</option>
                                        <option value="ç‰©è”ç½‘å·¥ç¨‹">ç‰©è”ç½‘å·¥ç¨‹</option>
                                        <option value="ç”µå­ä¿¡æ¯å·¥ç¨‹">ç”µå­ä¿¡æ¯å·¥ç¨‹</option>
                                        <option value="é€šä¿¡å·¥ç¨‹">é€šä¿¡å·¥ç¨‹</option>
                                        <option value="è‡ªåŠ¨åŒ–">è‡ªåŠ¨åŒ–</option>
                                    </select>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-users mr-2 text-blue-600"></i>ç­çº§
                                    </label>
                                    <input type="text" id="updateStudentClass" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all" placeholder="ä¾‹å¦‚ï¼š1">
                                    <i class="fa-solid fa-users absolute left-4 top-[42px] text-gray-400"></i>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-phone mr-2 text-blue-600"></i>è”ç³»æ–¹å¼
                                    </label>
                                    <input type="text" id="updateStudentContact" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-all" placeholder="ä¾‹å¦‚ï¼š13800138000">
                                    <i class="fa-solid fa-phone absolute left-4 top-[42px] text-gray-400"></i>
                                </div>
                            </div>
                            
                            <!-- è¾…å¯¼å‘˜é¢å¤–å±æ€§ -->
                            <div id="updateCounselorFields" class="hidden bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-user-tie text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">è¾…å¯¼å‘˜ä¿¡æ¯</h4>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-purple-600"></i>è´Ÿè´£é™¢ç³»
                                    </label>
                                    <select id="updateCounselorDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-calendar mr-2 text-purple-600"></i>è´Ÿè´£å¹´çº§
                                    </label>
                                    <select id="updateCounselorGrade" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©å¹´çº§</option>
                                        <option value="2021">2021çº§</option>
                                        <option value="2022">2022çº§</option>
                                        <option value="2023">2023çº§</option>
                                        <option value="2024">2024çº§</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-book mr-2 text-purple-600"></i>è´Ÿè´£ä¸“ä¸š
                                    </label>
                                    <select id="updateCounselorMajor" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©ä¸“ä¸š</option>
                                        <option value="è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯">è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</option>
                                        <option value="è½¯ä»¶å·¥ç¨‹">è½¯ä»¶å·¥ç¨‹</option>
                                        <option value="ç½‘ç»œå·¥ç¨‹">ç½‘ç»œå·¥ç¨‹</option>
                                        <option value="ä¿¡æ¯å®‰å…¨">ä¿¡æ¯å®‰å…¨</option>
                                        <option value="æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯">æ•°æ®ç§‘å­¦ä¸å¤§æ•°æ®æŠ€æœ¯</option>
                                        <option value="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½</option>
                                        <option value="ç‰©è”ç½‘å·¥ç¨‹">ç‰©è”ç½‘å·¥ç¨‹</option>
                                        <option value="ç”µå­ä¿¡æ¯å·¥ç¨‹">ç”µå­ä¿¡æ¯å·¥ç¨‹</option>
                                        <option value="é€šä¿¡å·¥ç¨‹">é€šä¿¡å·¥ç¨‹</option>
                                        <option value="è‡ªåŠ¨åŒ–">è‡ªåŠ¨åŒ–</option>
                                    </select>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-phone mr-2 text-purple-600"></i>è”ç³»æ–¹å¼
                                    </label>
                                    <input type="text" id="updateCounselorContact" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500 transition-all" placeholder="ä¾‹å¦‚ï¼š13800138000">
                                    <i class="fa-solid fa-phone absolute left-4 top-[42px] text-gray-400"></i>
                                </div>
                            </div>
                            
                            <!-- æ•™å¸ˆé¢å¤–å±æ€§ -->
                            <div id="updateTeacherFields" class="hidden bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border-2 border-amber-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-chalkboard-user text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">æ•™å¸ˆä¿¡æ¯</h4>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-amber-600"></i>éƒ¨é—¨/é™¢ç³»
                                    </label>
                                    <select id="updateTeacherDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-amber-500/30 focus:border-amber-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-phone mr-2 text-amber-600"></i>è”ç³»æ–¹å¼
                                    </label>
                                    <input type="text" id="updateTeacherContact" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-amber-500/30 focus:border-amber-500 transition-all" placeholder="ä¾‹å¦‚ï¼š13800138000">
                                    <i class="fa-solid fa-phone absolute left-4 top-[42px] text-gray-400"></i>
                                </div>
                            </div>
                            
                            <!-- ç®¡ç†å‘˜é¢å¤–å±æ€§ -->
                            <div id="updateAdminFields" class="hidden bg-gradient-to-r from-red-50 to-rose-50 rounded-2xl p-6 border-2 border-red-200 space-y-4">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-user-shield text-white"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800">ç®¡ç†å‘˜ä¿¡æ¯</h4>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                                        <i class="fa-solid fa-building mr-2 text-red-600"></i>éƒ¨é—¨/é™¢ç³»
                                    </label>
                                    <select id="updateAdminDept" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-white focus:ring-2 focus:ring-red-500/30 focus:border-red-500 transition-all">
                                        <option value="">è¯·é€‰æ‹©é™¢ç³»</option>
                                        <option value="è®¡ç®—æœºå­¦é™¢">è®¡ç®—æœºå­¦é™¢</option>
                                        <option value="è½¯ä»¶å­¦é™¢">è½¯ä»¶å­¦é™¢</option>
                                        <option value="ä¿¡æ¯å·¥ç¨‹å­¦é™¢">ä¿¡æ¯å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ç”µå­å·¥ç¨‹å­¦é™¢">ç”µå­å·¥ç¨‹å­¦é™¢</option>
                                        <option value="æœºæ¢°å·¥ç¨‹å­¦é™¢">æœºæ¢°å·¥ç¨‹å­¦é™¢</option>
                                        <option value="ææ–™ç§‘å­¦å­¦é™¢">ææ–™ç§‘å­¦å­¦é™¢</option>
                                        <option value="ç»æµç®¡ç†å­¦é™¢">ç»æµç®¡ç†å­¦é™¢</option>
                                        <option value="å¤–å›½è¯­å­¦é™¢">å¤–å›½è¯­å­¦é™¢</option>
                                        <option value="æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢">æ•°å­¦ä¸ç»Ÿè®¡å­¦é™¢</option>
                                        <option value="ç‰©ç†å­¦é™¢">ç‰©ç†å­¦é™¢</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="pt-4 flex gap-3">
                                <button type="submit" class="flex-1 py-3.5 bg-gradient-to-r from-cyan-500 to-primary text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all btn-glow flex items-center justify-center">
                                    <i class="fa-solid fa-pen-to-square mr-2"></i>ç¡®è®¤ä¿®æ”¹
                                </button>
                                <button type="button" onclick="document.getElementById('updateUserForm').reset()" class="px-6 py-3.5 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-all flex items-center justify-center">
                                    <i class="fa-solid fa-rotate-left mr-2"></i>é‡ç½®
                                </button>
                            </div>
                        </form>
                    `;
                    
                    // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åŠŸèƒ½
                    document.getElementById('searchUserBtn').addEventListener('click', async function() {
                        const account = document.getElementById('updateAccount').value.trim();
                        if (!account) {
                            const messageEl = document.getElementById('formMessage');
                            messageEl.textContent = 'è¯·è¾“å…¥è´¦å·';
                            messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-600';
                            messageEl.classList.remove('hidden');
                            return;
                        }
                        
                        try {
                            const response = await fetch('/api/admin/users');
                            const result = await response.json();
                            
                            if (result.success) {
                                const user = result.data.find(u => u.user_account === account);
                                
                                if (user) {
                                    // è§’è‰²åç§°æ˜ å°„
                                    const roleNames = {1: 'å­¦ç”Ÿ', 2: 'è¾…å¯¼å‘˜', 3: 'æ•™å¸ˆ', 4: 'ç®¡ç†å‘˜'};
                                    const roleIcons = {1: 'fa-graduation-cap', 2: 'fa-user-tie', 3: 'fa-chalkboard-user', 4: 'fa-user-shield'};
                                    const roleColors = {1: 'from-blue-500 to-indigo-600', 2: 'from-purple-500 to-pink-600', 3: 'from-amber-500 to-orange-600', 4: 'from-red-500 to-rose-600'};
                                    const roleBadgeColors = {1: 'bg-blue-100 text-blue-700', 2: 'bg-purple-100 text-purple-700', 3: 'bg-amber-100 text-amber-700', 4: 'bg-red-100 text-red-700'};
                                    
                                    // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                                    const userInfoDisplay = document.getElementById('userInfoDisplay');
                                    userInfoDisplay.classList.remove('hidden');
                                    document.getElementById('displayAccount').textContent = user.user_account;
                                    document.getElementById('displayName').textContent = user.user_name;
                                    document.getElementById('displayRole').textContent = roleNames[user.role_type];
                                    
                                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œè‡ªåŠ¨å¡«å……è¡¨å•
                                    userInfoDisplay.onclick = function() {
                                        // ç®¡ç†å‘˜ç”¨æˆ·ä¸å¯ç¼–è¾‘
                                        if (user.role_type === 4) {
                                            const messageEl = document.getElementById('formMessage');
                                            messageEl.innerHTML = '<i class="fa-solid fa-shield-halved mr-2"></i><strong>ç³»ç»Ÿä¿æŠ¤</strong>ï¼šç®¡ç†å‘˜ç”¨æˆ·ä¿¡æ¯å—ä¿æŠ¤ï¼Œä¸å…è®¸ç¼–è¾‘';
                                            messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-700 border-2 border-red-300 font-semibold animate-pulse';
                                            messageEl.classList.remove('hidden');
                                            
                                            // 5ç§’åè‡ªåŠ¨éšè—æç¤º
                                            setTimeout(() => {
                                                messageEl.classList.add('hidden');
                                            }, 5000);
                                            return;
                                        }
                                        
                                        // è‡ªåŠ¨å¡«å……å§“ååˆ°ç¼–è¾‘è¡¨å•
                                        document.getElementById('updateName').value = user.user_name;
                                        
                                        // éšè—æ‰€æœ‰ç±»å‹çš„é¢å¤–å­—æ®µ
                                        document.getElementById('updateStudentFields').classList.add('hidden');
                                        document.getElementById('updateCounselorFields').classList.add('hidden');
                                        document.getElementById('updateTeacherFields').classList.add('hidden');
                                        document.getElementById('updateAdminFields').classList.add('hidden');
                                        
                                        // æ ¹æ®ç”¨æˆ·ç±»å‹æ˜¾ç¤ºå¹¶å¡«å……å¯¹åº”çš„ç¼–è¾‘å­—æ®µ
                                        if (user.role_type === 1) {
                                            // å­¦ç”Ÿ
                                            const studentFields = document.getElementById('updateStudentFields');
                                            studentFields.classList.remove('hidden');
                                            if (user.dept) document.getElementById('updateStudentDept').value = user.dept;
                                            if (user.grade) document.getElementById('updateStudentGrade').value = user.grade;
                                            if (user.major) document.getElementById('updateStudentMajor').value = user.major;
                                            if (user.class_num) document.getElementById('updateStudentClass').value = user.class_num;
                                            if (user.contact) document.getElementById('updateStudentContact').value = user.contact;
                                        } else if (user.role_type === 2) {
                                            // è¾…å¯¼å‘˜
                                            const counselorFields = document.getElementById('updateCounselorFields');
                                            counselorFields.classList.remove('hidden');
                                            if (user.dept) document.getElementById('updateCounselorDept').value = user.dept;
                                            if (user.grade) document.getElementById('updateCounselorGrade').value = user.grade;
                                            if (user.major) document.getElementById('updateCounselorMajor').value = user.major;
                                            if (user.contact) document.getElementById('updateCounselorContact').value = user.contact;
                                        } else if (user.role_type === 3) {
                                            // æ•™å¸ˆ
                                            const teacherFields = document.getElementById('updateTeacherFields');
                                            teacherFields.classList.remove('hidden');
                                            if (user.dept) document.getElementById('updateTeacherDept').value = user.dept;
                                            if (user.contact) document.getElementById('updateTeacherContact').value = user.contact;
                                        }
                                        
                                        // æ»šåŠ¨åˆ°ç¼–è¾‘åŒºåŸŸ
                                        document.getElementById('updateName').scrollIntoView({ behavior: 'smooth', block: 'center' });
                                        
                                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                                        const messageEl = document.getElementById('formMessage');
                                        messageEl.textContent = 'âœ… å·²è‡ªåŠ¨å¡«å……ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥ç¼–è¾‘åæäº¤';
                                        messageEl.className = 'mb-4 p-4 rounded-xl bg-green-50 text-green-700 border border-green-200';
                                        messageEl.classList.remove('hidden');
                                        
                                        // 3ç§’åè‡ªåŠ¨éšè—æç¤º
                                        setTimeout(() => {
                                            messageEl.classList.add('hidden');
                                        }, 3000);
                                    };
                                    
                                    // è®¾ç½®è§’è‰²å›¾æ ‡å’Œé¢œè‰²
                                    const iconEl = document.getElementById('userRoleIcon');
                                    iconEl.className = `fa-solid ${roleIcons[user.role_type]} text-white text-2xl`;
                                    iconEl.parentElement.className = `w-14 h-14 rounded-xl bg-gradient-to-br ${roleColors[user.role_type]} flex items-center justify-center mr-4 flex-shrink-0`;
                                    
                                    const badgeEl = document.getElementById('userRoleBadge');
                                    badgeEl.textContent = roleNames[user.role_type];
                                    badgeEl.className = `ml-3 px-3 py-1 text-xs rounded-full font-semibold ${roleBadgeColors[user.role_type]}`;
                                    
                                    // æ ¹æ®è§’è‰²æ˜¾ç¤ºä¸åŒä¿¡æ¯
                                    document.getElementById('displayDeptContainer').classList.add('hidden');
                                    document.getElementById('displayGradeContainer').classList.add('hidden');
                                    document.getElementById('displayMajorContainer').classList.add('hidden');
                                    document.getElementById('displayContactContainer').classList.add('hidden');
                                    
                                    if (user.dept) {
                                        document.getElementById('displayDeptContainer').classList.remove('hidden');
                                        document.getElementById('displayDept').textContent = user.dept;
                                    }
                                    if (user.grade) {
                                        document.getElementById('displayGradeContainer').classList.remove('hidden');
                                        document.getElementById('displayGrade').textContent = user.grade;
                                    }
                                    if (user.major) {
                                        document.getElementById('displayMajorContainer').classList.remove('hidden');
                                        document.getElementById('displayMajor').textContent = user.major;
                                    }
                                    if (user.contact) {
                                        document.getElementById('displayContactContainer').classList.remove('hidden');
                                        document.getElementById('displayContact').textContent = user.contact;
                                    }
                                    
                                    // æ¸…é™¤é”™è¯¯æç¤º
                                    const formMessage = document.getElementById('formMessage');
                                    if (formMessage.className.includes('red')) {
                                        formMessage.classList.add('hidden');
                                    }
                                } else {
                                    document.getElementById('userInfoDisplay').classList.add('hidden');
                                    const messageEl = document.getElementById('formMessage');
                                    messageEl.textContent = 'æœªæ‰¾åˆ°è¯¥è´¦å·å¯¹åº”çš„ç”¨æˆ·';
                                    messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-600';
                                    messageEl.classList.remove('hidden');
                                }
                            }
                        } catch (error) {
                            console.error('æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                            const messageEl = document.getElementById('formMessage');
                            messageEl.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•';
                            messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-600';
                            messageEl.classList.remove('hidden');
                        }
                    });
                    
                    // ç»‘å®šä¿®æ”¹ç”¨æˆ·è¡¨å•æäº¤äº‹ä»¶
                    document.getElementById('updateUserForm').addEventListener('submit', async function(e) {
                        e.preventDefault();
                        const account = document.getElementById('updateAccount').value;
                        const userType = document.getElementById('updateUserType').value;
                        const newName = document.getElementById('updateName').value;
                        const newPassword = document.getElementById('updatePassword').value;
                        
                        // è§’è‰²ç±»å‹æ˜ å°„
                        const roleMap = {
                            'student': 1,
                            'counselor': 2,
                            'teacher': 3,
                            'admin': 4
                        };
                        
                        // å‡†å¤‡æäº¤æ•°æ®
                        const updateData = {};
                        if (newName) updateData.new_name = newName;
                        if (newPassword) updateData.new_password = newPassword;
                        if (userType) updateData.new_role = roleMap[userType];
                        
                        // æ”¶é›†é¢å¤–å­—æ®µæ•°æ®ï¼ˆæ ¹æ®å½“å‰æ˜¾ç¤ºçš„å­—æ®µåŒºåŸŸï¼‰
                        const studentFields = document.getElementById('updateStudentFields');
                        const counselorFields = document.getElementById('updateCounselorFields');
                        const teacherFields = document.getElementById('updateTeacherFields');
                        const adminFields = document.getElementById('updateAdminFields');
                        
                        if (!studentFields.classList.contains('hidden')) {
                            // å­¦ç”Ÿé¢å¤–å­—æ®µ
                            const dept = document.getElementById('updateStudentDept').value;
                            const grade = document.getElementById('updateStudentGrade').value;
                            const major = document.getElementById('updateStudentMajor').value;
                            const classNum = document.getElementById('updateStudentClass').value;
                            const contact = document.getElementById('updateStudentContact').value;
                            
                            if (dept) updateData.new_dept = dept;
                            if (grade) updateData.new_grade = grade;
                            if (major) updateData.new_major = major;
                            if (classNum) updateData.new_class_num = classNum;
                            if (contact) updateData.new_contact = contact;
                        } else if (!counselorFields.classList.contains('hidden')) {
                            // è¾…å¯¼å‘˜é¢å¤–å­—æ®µ
                            const dept = document.getElementById('updateCounselorDept').value;
                            const grade = document.getElementById('updateCounselorGrade').value;
                            const major = document.getElementById('updateCounselorMajor').value;
                            const contact = document.getElementById('updateCounselorContact').value;
                            
                            if (dept) updateData.new_dept = dept;
                            if (grade) updateData.new_responsible_grade = grade;
                            if (major) updateData.new_responsible_major = major;
                            if (contact) updateData.new_contact = contact;
                        } else if (!teacherFields.classList.contains('hidden')) {
                            // æ•™å¸ˆé¢å¤–å­—æ®µ
                            const dept = document.getElementById('updateTeacherDept').value;
                            const contact = document.getElementById('updateTeacherContact').value;
                            
                            if (dept) updateData.new_dept = dept;
                            if (contact) updateData.new_contact = contact;
                        } else if (!adminFields.classList.contains('hidden')) {
                            // ç®¡ç†å‘˜é¢å¤–å­—æ®µ
                            const dept = document.getElementById('updateAdminDept').value;
                            
                            if (dept) updateData.new_dept = dept;
                        }
                        
                        try {
                            const response = await fetch(`/api/admin/users/${account}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(updateData)
                            });
                            
                            const result = await response.json();
                            const messageEl = document.getElementById('formMessage');
                            
                            if (result.success) {
                                messageEl.textContent = 'âœ… ' + result.message;
                                messageEl.className = 'mb-4 p-4 rounded-xl bg-green-50 text-green-700 border border-green-200';
                                messageEl.classList.remove('hidden');
                            } else {
                                messageEl.textContent = 'âŒ ' + result.message;
                                messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-600 border border-red-200';
                                messageEl.classList.remove('hidden');
                            }
                        } catch (error) {
                            console.error('ä¿®æ”¹ç”¨æˆ·å¤±è´¥:', error);
                            const messageEl = document.getElementById('formMessage');
                            messageEl.textContent = 'âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•';
                            messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-600 border border-red-200';
                            messageEl.classList.remove('hidden');
                        }
                    });
                    break;
                case 'delete-user':
                    modalTitle.textContent = 'åˆ é™¤ç”¨æˆ·';
                    modalSubtitle.textContent = 'æ°¸ä¹…ç§»é™¤ç”¨æˆ·è´¦æˆ·ï¼ˆä¸å¯æ¢å¤ï¼‰';
                    modalIcon.className = 'fa-solid fa-user-xmark text-white text-xl';
                    modalBody.innerHTML = `
                        <div id="formMessage" class="hidden mb-4 p-4 rounded-xl"></div>
                        
                        <!-- è­¦å‘Šæç¤º -->
                        <div class="bg-gradient-to-r from-red-50 to-rose-50 rounded-2xl p-6 border-2 border-red-200 mb-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 rounded-xl bg-red-500 flex items-center justify-center animate-pulse">
                                        <i class="fa-solid fa-triangle-exclamation text-white text-xl"></i>
                                    </div>
                                </div>
                                <div class="ml-4 flex-1">
                                    <h4 class="text-lg font-bold text-red-800 mb-2 flex items-center">
                                        <i class="fa-solid fa-skull-crossbones mr-2"></i>å±é™©æ“ä½œè­¦å‘Š
                                    </h4>
                                    <ul class="space-y-1.5 text-sm text-red-700">
                                        <li class="flex items-start">
                                            <i class="fa-solid fa-circle-xmark mr-2 mt-0.5 text-red-500"></i>
                                            <span>åˆ é™¤æ“ä½œ<strong>ä¸å¯æ¢å¤</strong>ï¼Œç”¨æˆ·æ•°æ®å°†æ°¸ä¹…ä¸¢å¤±</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i class="fa-solid fa-circle-xmark mr-2 mt-0.5 text-red-500"></i>
                                            <span>è¯·ç¡®è®¤è´¦å·ä¿¡æ¯æ— è¯¯åå†æ‰§è¡Œåˆ é™¤</span>
                                        </li>
                                        <li class="flex items-start">
                                            <i class="fa-solid fa-circle-xmark mr-2 mt-0.5 text-red-500"></i>
                                            <span>å»ºè®®å…ˆå¤‡ä»½é‡è¦æ•°æ®</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <form id="deleteUserForm" class="space-y-5">
                            <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl p-6 border-2 border-dashed border-gray-300">
                                <div class="flex items-center mb-3">
                                    <i class="fa-solid fa-magnifying-glass text-gray-600 text-xl mr-3"></i>
                                    <h4 class="font-bold text-gray-800">è¾“å…¥è¦åˆ é™¤çš„è´¦å·</h4>
                                </div>
                                <div class="relative">
                                    <input type="text" id="deleteAccount" class="w-full px-4 py-3 pl-12 rounded-xl border-2 border-gray-300 bg-white focus:ring-2 focus:ring-red-500/30 focus:border-red-500 transition-all font-medium" placeholder="è¯·è¾“å…¥è¦åˆ é™¤çš„è´¦å·" required>
                                    <i class="fa-solid fa-hashtag absolute left-4 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
                            <div id="deleteUserInfo" class="hidden bg-blue-50 rounded-2xl p-5 border-2 border-blue-200">
                                <div class="flex items-start">
                                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mr-4">
                                        <i class="fa-solid fa-user text-white text-xl"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-gray-800 mb-3">ç”¨æˆ·ä¿¡æ¯</h4>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex items-center">
                                                <span class="text-gray-600 w-20">è´¦å·ï¼š</span>
                                                <span class="font-semibold text-gray-800" id="deleteUserAccount">-</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-gray-600 w-20">å§“åï¼š</span>
                                                <span class="font-semibold text-gray-800" id="deleteUserName">-</span>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="text-gray-600 w-20">è§’è‰²ï¼š</span>
                                                <span class="font-semibold text-gray-800" id="deleteUserRole">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
                                <div class="flex items-center text-amber-800">
                                    <i class="fa-solid fa-lightbulb mr-2 text-amber-600"></i>
                                    <span class="text-sm font-medium">æç¤ºï¼šåˆ é™¤å‰ç³»ç»Ÿä¼šå†æ¬¡è¦æ±‚æ‚¨ç¡®è®¤</span>
                                </div>
                            </div>
                            
                            <div class="pt-4 flex gap-3">
                                <button type="submit" class="flex-1 py-3.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all btn-glow flex items-center justify-center group">
                                    <i class="fa-solid fa-trash-can mr-2 group-hover:animate-bounce"></i>ç¡®è®¤åˆ é™¤
                                </button>
                                <button type="button" onclick="document.getElementById('actionModal').classList.add('hidden')" class="px-6 py-3.5 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-all flex items-center justify-center">
                                    <i class="fa-solid fa-xmark mr-2"></i>å–æ¶ˆ
                                </button>
                            </div>
                        </form>
                    `;
                    
                    // ç›‘å¬è´¦å·è¾“å…¥ï¼Œå®æ—¶æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
                    const deleteAccountInput = document.getElementById('deleteAccount');
                    const deleteUserInfo = document.getElementById('deleteUserInfo');
                    let searchTimeout;
                    let currentDeleteUserRole = null; // ä¿å­˜å½“å‰è¦åˆ é™¤çš„ç”¨æˆ·è§’è‰²
                    
                    deleteAccountInput.addEventListener('input', function() {
                        const account = this.value.trim();
                        
                        // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                        clearTimeout(searchTimeout);
                        
                        if (!account) {
                            deleteUserInfo.classList.add('hidden');
                            currentDeleteUserRole = null;
                            return;
                        }
                        
                        // è®¾ç½®å»¶è¿ŸæŸ¥è¯¢ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
                        searchTimeout = setTimeout(async () => {
                            try {
                                const response = await fetch('/api/admin/users');
                                const result = await response.json();
                                
                                if (result.success) {
                                    const user = result.data.find(u => u.user_account === account);
                                    
                                    if (user) {
                                        // è§’è‰²åç§°æ˜ å°„
                                        const roleNames = {1: 'å­¦ç”Ÿ', 2: 'è¾…å¯¼å‘˜', 3: 'æ•™å¸ˆ', 4: 'ç®¡ç†å‘˜'};
                                        
                                        // ä¿å­˜ç”¨æˆ·è§’è‰²ç±»å‹
                                        currentDeleteUserRole = user.role_type;
                                        
                                        document.getElementById('deleteUserAccount').textContent = user.user_account;
                                        document.getElementById('deleteUserName').textContent = user.user_name;
                                        document.getElementById('deleteUserRole').textContent = roleNames[user.role_type];
                                        
                                        // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºä¿æŠ¤æç¤º
                                        if (user.role_type === 4) {
                                            deleteUserInfo.className = 'bg-red-50 rounded-2xl p-5 border-2 border-red-300';
                                            deleteUserInfo.innerHTML = `
                                                <div class="flex items-start">
                                                    <div class="w-12 h-12 rounded-xl bg-red-500 flex items-center justify-center mr-4 animate-pulse">
                                                        <i class="fa-solid fa-shield-halved text-white text-xl"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h4 class="font-bold text-red-800 mb-3 text-lg">ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤ç”¨æˆ·</h4>
                                                        <div class="space-y-2 text-sm">
                                                            <div class="flex items-center">
                                                                <span class="text-red-700 font-medium w-20">è´¦å·ï¼š</span>
                                                                <span class="font-bold text-red-900">${user.user_account}</span>
                                                            </div>
                                                            <div class="flex items-center">
                                                                <span class="text-red-700 font-medium w-20">å§“åï¼š</span>
                                                                <span class="font-bold text-red-900">${user.user_name}</span>
                                                            </div>
                                                            <div class="flex items-center">
                                                                <span class="text-red-700 font-medium w-20">è§’è‰²ï¼š</span>
                                                                <span class="font-bold text-red-900">${roleNames[user.role_type]}</span>
                                                            </div>
                                                            <div class="mt-3 p-3 bg-red-100 rounded-lg border border-red-400">
                                                                <p class="text-red-800 font-semibold text-center">
                                                                    <i class="fa-solid fa-ban mr-2"></i>è¯¥ç”¨æˆ·ä¸ºç®¡ç†å‘˜ï¼Œå—ç³»ç»Ÿä¿æŠ¤ï¼Œä¸å…è®¸åˆ é™¤
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            `;
                                        } else {
                                            deleteUserInfo.className = 'bg-blue-50 rounded-2xl p-5 border-2 border-blue-200';
                                            deleteUserInfo.innerHTML = `
                                                <div class="flex items-start">
                                                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mr-4">
                                                        <i class="fa-solid fa-user text-white text-xl"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h4 class="font-bold text-gray-800 mb-3">ç”¨æˆ·ä¿¡æ¯</h4>
                                                        <div class="space-y-2 text-sm">
                                                            <div class="flex items-center">
                                                                <span class="text-gray-600 w-20">è´¦å·ï¼š</span>
                                                                <span class="font-semibold text-gray-800">${user.user_account}</span>
                                                            </div>
                                                            <div class="flex items-center">
                                                                <span class="text-gray-600 w-20">å§“åï¼š</span>
                                                                <span class="font-semibold text-gray-800">${user.user_name}</span>
                                                            </div>
                                                            <div class="flex items-center">
                                                                <span class="text-gray-600 w-20">è§’è‰²ï¼š</span>
                                                                <span class="font-semibold text-gray-800">${roleNames[user.role_type]}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            `;
                                        }
                                        
                                        deleteUserInfo.classList.remove('hidden');
                                    } else {
                                        deleteUserInfo.classList.add('hidden');
                                        currentDeleteUserRole = null;
                                    }
                                }
                            } catch (error) {
                                console.error('æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                                deleteUserInfo.classList.add('hidden');
                                currentDeleteUserRole = null;
                            }
                        }, 500); // 500mså»¶è¿Ÿ
                    });
                    
                    // ç»‘å®šåˆ é™¤ç”¨æˆ·è¡¨å•æäº¤äº‹ä»¶
                    document.getElementById('deleteUserForm').addEventListener('submit', async function(e) {
                        e.preventDefault();
                        const account = document.getElementById('deleteAccount').value;
                        
                        // æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜ç”¨æˆ·
                        if (currentDeleteUserRole === 4) {
                            const messageEl = document.getElementById('formMessage');
                            messageEl.innerHTML = '<i class="fa-solid fa-shield-halved mr-2"></i><strong>ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤</strong>ï¼šç®¡ç†å‘˜ç”¨æˆ·å—ç³»ç»Ÿä¿æŠ¤ï¼Œä¸å…è®¸åˆ é™¤æ“ä½œï¼';
                            messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-700 border-2 border-red-300 font-semibold animate-pulse';
                            messageEl.classList.remove('hidden');
                            
                            // 5ç§’åè‡ªåŠ¨éšè—æç¤º
                            setTimeout(() => {
                                messageEl.classList.add('hidden');
                            }, 5000);
                            return;
                        }
                        
                        if (!confirm(`âš ï¸ ç¡®å®šè¦åˆ é™¤è´¦å·ä¸º ${account} çš„ç”¨æˆ·å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼`)) {
                            return;
                        }
                        
                        try {
                            const response = await fetch(`/api/admin/users/${account}`, {
                                method: 'DELETE'
                            });
                            
                            const result = await response.json();
                            const messageEl = document.getElementById('formMessage');
                            
                            if (result.success) {
                                messageEl.innerHTML = '<i class="fa-solid fa-circle-check mr-2"></i>' + result.message;
                                messageEl.className = 'mb-4 p-4 rounded-xl bg-green-50 text-green-700 border border-green-200 font-semibold';
                                messageEl.classList.remove('hidden');
                                // æ¸…ç©ºè¡¨å•å¹¶éšè—ç”¨æˆ·ä¿¡æ¯
                                this.reset();
                                document.getElementById('deleteUserInfo').classList.add('hidden');
                                currentDeleteUserRole = null;
                            } else {
                                messageEl.innerHTML = '<i class="fa-solid fa-circle-xmark mr-2"></i>' + result.message;
                                messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-700 border border-red-200 font-semibold';
                                messageEl.classList.remove('hidden');
                            }
                        } catch (error) {
                            console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥:', error);
                            const messageEl = document.getElementById('formMessage');
                            messageEl.innerHTML = '<i class="fa-solid fa-circle-xmark mr-2"></i>ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•';
                            messageEl.className = 'mb-4 p-4 rounded-xl bg-red-50 text-red-700 border border-red-200 font-semibold';
                            messageEl.classList.remove('hidden');
                        }
                    });
                    break;
                default:
                    modalTitle.textContent = 'æ“ä½œçª—å£';
                    modalBody.innerHTML = '<p>æœªçŸ¥æ“ä½œ</p>';
            }
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.classList.remove('hidden');
        }
        
        // åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUserData(modalBody, userType) {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                modalBody.innerHTML = `
                    <div class="text-center py-12">
                        <div class="inline-block p-4 rounded-2xl bg-primary/5 mb-4">
                            <i class="fa-solid fa-spinner fa-spin text-3xl text-primary"></i>
                        </div>
                        <p class="text-lg font-medium text-gray-600">æ­£åœ¨åŠ è½½æ•°æ®...</p>
                    </div>
                `;
                
                const response = await fetch('/api/admin/users');
                const result = await response.json();
                
                if (!result.success) {
                    modalBody.innerHTML = `
                        <div class="text-center py-12">
                            <div class="inline-block p-4 rounded-2xl bg-red-50 mb-4">
                                <i class="fa-solid fa-circle-exclamation text-3xl text-red-500"></i>
                            </div>
                            <p class="text-lg font-medium text-red-600">${result.message}</p>
                        </div>
                    `;
                    return;
                }
                
                // è§’è‰²ç±»å‹æ˜ å°„
                const roleTypeMap = {
                    1: 'student',
                    2: 'counselor',
                    3: 'teacher',
                    4: 'admin'
                };
                
                // è§’è‰²åç§°æ˜ å°„
                const roleNameMap = {
                    1: 'å­¦ç”Ÿ',
                    2: 'è¾…å¯¼å‘˜',
                    3: 'æ•™å¸ˆ',
                    4: 'ç®¡ç†å‘˜'
                };
                
                // è§’è‰²å›¾æ ‡æ˜ å°„
                const roleIconMap = {
                    1: 'fa-user-graduate',
                    2: 'fa-user-tie',
                    3: 'fa-chalkboard-user',
                    4: 'fa-user-shield'
                };
                
                // è§’è‰²é¢œè‰²æ˜ å°„
                const roleColorMap = {
                    1: 'blue',
                    2: 'purple',
                    3: 'amber',
                    4: 'red'
                };
                
                // ç­›é€‰æŒ‡å®šç±»å‹çš„ç”¨æˆ·
                const filteredUsers = result.data.filter(user => 
                    roleTypeMap[user.role_type] === userType
                );
                
                if (filteredUsers.length === 0) {
                    modalBody.innerHTML = `
                        <div class="text-center py-16">
                            <div class="inline-block p-6 rounded-3xl bg-gray-50 mb-6">
                                <i class="fa-solid fa-inbox text-6xl text-gray-300"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-600 mb-2">æš‚æ— æ•°æ®</h3>
                            <p class="text-gray-400">å½“å‰æ²¡æœ‰${roleNameMap[Object.keys(roleTypeMap).find(key => roleTypeMap[key] === userType)]}ç”¨æˆ·</p>
                        </div>
                    `;
                    return;
                }
                
                // ç”Ÿæˆç¾åŒ–çš„è¡¨æ ¼
                let tableHtml = `
                    <div class="mb-4 flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-accent/10 flex items-center justify-center">
                                <i class="fa-solid fa-database text-primary"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">å…±æ‰¾åˆ°</p>
                                <p class="text-lg font-bold text-gray-800">${filteredUsers.length} æ¡è®°å½•</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-hidden rounded-2xl border border-gray-200 shadow-sm">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gradient-to-r from-primary/10 to-accent/10">
                                    <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-hashtag mr-2 text-primary"></i>è´¦å·
                                        </div>
                                    </th>
                                    <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-user mr-2 text-primary"></i>å§“å
                                        </div>
                                    </th>`;
                
                // æ ¹æ®ç”¨æˆ·ç±»å‹æ·»åŠ ä¸åŒçš„åˆ—
                if (userType === 'student') {
                    tableHtml += `
                                    <th class="px-4 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-id-card mr-2 text-primary"></i>å­¦å·
                                        </div>
                                    </th>
                                    <th class="px-4 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-building mr-2 text-primary"></i>éƒ¨é—¨
                                        </div>
                                    </th>
                                    <th class="px-4 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-calendar mr-2 text-primary"></i>å¹´çº§
                                        </div>
                                    </th>
                                    <th class="px-4 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-graduation-cap mr-2 text-primary"></i>ä¸“ä¸š
                                        </div>
                                    </th>
                                    <th class="px-4 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-users mr-2 text-primary"></i>ç­çº§
                                        </div>
                                    </th>
                                    <th class="px-4 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-phone mr-2 text-primary"></i>è”ç³»æ–¹å¼
                                        </div>
                                    </th>`;
                } else {
                    tableHtml += `
                                    <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">
                                        <div class="flex items-center">
                                            <i class="fa-solid fa-user-tag mr-2 text-primary"></i>è§’è‰²
                                        </div>
                                    </th>`;
                }
                
                tableHtml += `
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-100">
                `;
                
                filteredUsers.forEach((user, index) => {
                    const color = roleColorMap[user.role_type];
                    const icon = roleIconMap[user.role_type];
                    tableHtml += `
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-lg bg-${color}-100 flex items-center justify-center mr-3">
                                        <span class="text-${color}-600 font-bold text-sm">${index + 1}</span>
                                    </div>
                                    <span class="font-mono text-sm font-semibold text-gray-700">${user.user_account}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-primary to-accent flex items-center justify-center mr-3">
                                        <span class="text-white font-bold text-xs">${user.user_name.charAt(0)}</span>
                                    </div>
                                    <span class="font-medium text-gray-800">${user.user_name}</span>
                                </div>
                            </td>`;
                    
                    if (userType === 'student') {
                        tableHtml += `
                            <td class="px-4 py-4">
                                <span class="text-sm text-gray-700">${user.user_account}</span>
                            </td>
                            <td class="px-4 py-4">
                                <span class="text-sm text-gray-700">${user.dept || '-'}</span>
                            </td>
                            <td class="px-4 py-4">
                                <span class="text-sm text-gray-700">${user.grade || '-'}</span>
                            </td>
                            <td class="px-4 py-4">
                                <span class="text-sm text-gray-700">${user.major || '-'}</span>
                            </td>
                            <td class="px-4 py-4">
                                <span class="text-sm text-gray-700">${user.class_num || '-'}</span>
                            </td>
                            <td class="px-4 py-4">
                                <span class="text-sm text-gray-700">${user.contact || '-'}</span>
                            </td>`;
                    } else {
                        tableHtml += `
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-${color}-100 text-${color}-700">
                                    <i class="fa-solid ${icon} mr-1.5"></i>
                                    ${roleNameMap[user.role_type]}
                                </span>
                            </td>`;
                    }
                    
                    tableHtml += `
                        </tr>
                    `;
                });
                
                tableHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                modalBody.innerHTML = tableHtml;
                
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                modalBody.innerHTML = `
                    <div class="text-center py-12">
                        <div class="inline-block p-4 rounded-2xl bg-red-50 mb-4">
                            <i class="fa-solid fa-triangle-exclamation text-3xl text-red-500"></i>
                        </div>
                        <p class="text-lg font-medium text-red-600">åŠ è½½æ•°æ®å¤±è´¥</p>
                        <p class="text-sm text-gray-500 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // å¤´åƒä¸Šä¼ å¤„ç†å‡½æ•°
        function handleAvatarChange(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                showToast('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼', 'error');
                return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§2MBï¼‰
            if (file.size > 2 * 1024 * 1024) {
                showToast('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MBï¼', 'error');
                return;
            }
            
            // è¯»å–æ–‡ä»¶å¹¶é¢„è§ˆ
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatarPreview = document.getElementById('avatarPreview');
                const avatarText = document.getElementById('avatarText');
                
                // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
                avatarPreview.src = e.target.result;
                avatarPreview.classList.remove('hidden');
                avatarText.classList.add('hidden');
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('å¤´åƒå·²æ›´æ–°ï¼', 'success');
            };
            
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>